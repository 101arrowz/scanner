{"mappings":"iUACA,IAAIA,mVCqBJ,IAAuBC,EACDC,mFArBtB,IAAIC,EAAU,GAoBdF,WAlBkBG,GAGhB,IAFA,IAAIC,EAAOC,OAAOD,KAAKD,GAEdG,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/BJ,EAAQE,EAAKE,IAAMH,EAAMC,EAAKE,KAelCL,WAXiBO,GACf,IAAIC,EAAWP,EAAQM,GAEvB,GAAgB,MAAZC,EACF,MAAM,IAAIC,MAAM,oCAAsCF,GAGxD,OAAOC,MCnBTE,EAAA,SAAAC,SAA8CC,KAAKC,MAAM,iWFGzD,MAAMC,EAAO,IAAIC,MAAM,IAAIC,UAAKC,YAIvBC,EAAUC,GAAO,OAAOL,EAAKK,GAFtCL,EAAKM,UAAKH,EAAW,MAAM,GAAM,GAIjC,IAAII,EAAYP,EAAKR,gBAQZgB,EAAWH,GAChB,MAAMI,EAAML,EAAUC,GAEtB,gBATgBA,GACZA,EAAM,KACVL,EAAKK,GAAOE,EACZA,EAAYF,GAKZK,CAAWL,GACJI,WAGFE,EAAYC,GAEjB,MAAMC,SAAcD,EACpB,GAAY,UAARC,GAA4B,WAARA,GAA4B,MAAPD,EACzC,MAAM,GAAKA,IAEf,GAAY,UAARC,EACA,MAAM,IAAKD,KAEf,GAAY,UAARC,EAAkB,CAClB,MAAMC,EAAcF,EAAIE,YACxB,OAAmB,MAAfA,EACO,SAED,UAAWA,KAGzB,GAAY,YAARD,EAAoB,CACpB,MAAME,EAAOH,EAAIG,KACjB,MAAmB,iBAARA,GAAoBA,EAAKvB,OAAS,EACnC,YAAauB,KAEZ,WAIf,GAAId,MAAMe,QAAQJ,GAAM,CACpB,MAAMpB,EAASoB,EAAIpB,OACnB,IAAIyB,EAAQ,IACRzB,EAAS,IACTyB,GAASN,EAAYC,EAAI,KAE7B,IAAI,IAAIrB,EAAI,EAAGA,EAAIC,EAAQD,IACvB0B,GAAS,KAAON,EAAYC,EAAIrB,IAGpC,OADA0B,GAAS,IACFA,EAGX,MAAMC,EAAc,sBAAyBC,KAAKC,SAASC,KAAKT,IAChE,IAAIU,EACJ,KAAIJ,EAAe1B,OAAS,GAIxB,OAAO4B,SAASC,KAAKT,GAEzB,GALIU,EAAYJ,EAAe,GAKd,UAAbI,EAIA,IACI,MAAO,UAAYxB,KAAKyB,UAAUX,GAAO,IAC3C,MAAOY,GACL,MAAO,SAIf,OAAIZ,aAAejB,MACT,GAAIiB,EAAIG,SAASH,EAAIa,YAAYb,EAAIc,QAGxCJ,EAGX,IAAIK,EAAkB,EAElBC,EAAuB,cAClBC,IAIL,OAH6B,OAAzBD,GAAiCA,EAAqBE,SAAW9C,EAAK+C,OAAOD,SAC7EF,EAAuB,IAAII,WAAWhD,EAAK+C,OAAOD,SAE/CF,EAGX,IAAIK,EAAoB,IAAIC,YAAY,SAExC,MAAMC,EAAwD,mBAAjCF,EAAkBG,WACzC,SAAUC,EAAKC,GACjB,OAAOL,EAAkBG,WAAWC,EAAKC,IAEvC,SAAUD,EAAKC,GACjB,MAAMC,EAAMN,EAAkBO,OAAOH,GAErC,OADAC,EAAKG,IAAIF,GACF,CACHG,KAAML,EAAI7C,OACVmD,QAASJ,EAAI/C,SA0CrB,IAAIoD,EAAuB,cAClBC,IAIL,OAH6B,OAAzBD,GAAiCA,EAAqBd,SAAW9C,EAAK+C,OAAOD,SAC7Ec,EAAuB,IAAIE,WAAW9D,EAAK+C,OAAOD,SAE/Cc,EAGX,IAAIG,EAAoB,IAAIC,YAAY,QAAS,CAAEC,WAAW,EAAMC,OAAO,aAQlEC,EAAaC,EAAUC,GAC5B,KAAMD,aAAoBC,GACtB,MAAM,IAAI1D,MAAK,wBAAyB0D,EAAMtC,QAElD,OAAOqC,EAASE,aAGXC,EAAcC,GACfjD,IAAcP,EAAKR,QAAQQ,EAAKM,KAAKN,EAAKR,OAAS,GACvD,MAAMa,EAAME,EAIZ,OAHAA,EAAYP,EAAKK,GAEjBL,EAAKK,GAAOmD,EACLnD,WAWFoD,EAAWC,GAChB,OAAOA,MAAAA,EA/BXX,EAAkBY,SAuDlB,IAAIC,EAA8B,cAQzBC,EAA2BP,EAAKQ,GACrC,OAPoC,OAAhCF,GAAwCA,EAA4B9B,SAAW9C,EAAK+C,OAAOD,SAC3F8B,EAA8B,IAAIG,kBAAkB/E,EAAK+C,OAAOD,SAE7D8B,GAIyBI,SAASV,EAAM,EAAGA,EAAM,EAAIQ,YAGvDG,EAAYC,EAAGC,GACpB,IACI,OAAOD,EAAEE,MAAMC,KAAMF,GACvB,MAAOG,GACLtF,EAAKuF,qBAAqBhB,EAAce,WAKnCE,gBAEKlB,GACV,MAAME,EAAMlE,OAAOmF,OAAOD,EAAME,WAGhC,OAFAlB,EAAIF,IAAMA,EAEHE,EAGXmB,qBACI,MAAMrB,EAAMe,KAAKf,IAGjB,OAFAe,KAAKf,IAAM,EAEJA,EAGXsB,OACI,MAAMtB,EAAMe,KAAKM,qBACjB3F,EAAK6F,iBAAiBvB,GAItBI,QAEA,OADU1E,EAAK8F,kBAAkBT,KAAKf,KAMtCI,MAAEqB,GACF/F,EAAKgG,kBAAkBX,KAAKf,IAAKyB,GAIjCE,QAEA,OADUjG,EAAKkG,kBAAkBb,KAAKf,KAMtC2B,MAAEE,GACFnG,EAAKoG,kBAAkBf,KAAKf,IAAK6B,UAK5BE,gBAEKC,GACV,MAAM9B,EAAMlE,OAAOmF,OAAOY,EAAKX,WAG/B,OAFAlB,EAAIF,IAAMgC,EAEH9B,EAGXmB,qBACI,MAAMrB,EAAMe,KAAKf,IAGjB,OAFAe,KAAKf,IAAM,EAEJA,EAGXsB,OACI,MAAMtB,EAAMe,KAAKM,qBACjB3F,EAAKuG,gBAAgBjC,GAIrBkC,QACA,IAAI/E,EAAMzB,EAAKyG,iBAAiBpB,KAAKf,KACrC,OAAOkB,EAAMkB,OAAOjF,GAKpB+E,MAAEG,GACFxC,EAAawC,EAAMnB,GACnB,IAAIoB,EAAOD,EAAKrC,IAChBqC,EAAKrC,IAAM,EACXtE,EAAK6G,iBAAiBxB,KAAKf,IAAKsC,GAIhCE,QACA,IAAIrF,EAAMzB,EAAK+G,iBAAiB1B,KAAKf,KACrC,OAAOkB,EAAMkB,OAAOjF,GAKpBqF,MAAEE,GACF7C,EAAa6C,EAAMxB,GACnB,IAAIoB,EAAOI,EAAK1C,IAChB0C,EAAK1C,IAAM,EACXtE,EAAKiH,iBAAiB5B,KAAKf,IAAKsC,GAIhCM,QACA,IAAIzF,EAAMzB,EAAKmH,iBAAiB9B,KAAKf,KACrC,OAAOkB,EAAMkB,OAAOjF,GAKpByF,MAAEE,GACFjD,EAAaiD,EAAM5B,GACnB,IAAIoB,EAAOQ,EAAK9C,IAChB8C,EAAK9C,IAAM,EACXtE,EAAKqH,iBAAiBhC,KAAKf,IAAKsC,GAIhCU,QACA,IAAI7F,EAAMzB,EAAKuH,iBAAiBlC,KAAKf,KACrC,OAAOkB,EAAMkB,OAAOjF,GAKpB6F,MAAEE,GACFrD,EAAaqD,EAAMhC,GACnB,IAAIoB,EAAOY,EAAKlD,IAChBkD,EAAKlD,IAAM,EACXtE,EAAKyH,iBAAiBpC,KAAKf,IAAKsC,GAWlCc,YACUC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACpC,IAAIzG,EAAMzB,EAAKmI,SAASR,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACpD,OAAO7B,EAAKK,OAAOjF,4CG1U3B,IAAoB2G,EAEHC,yFA9CjB,IAAIC,EAAY,YA6BPC,EAAWC,GAClB,OAAQ,GAAKA,GAAKC,QAAO,wCAA0C,MAAQ,IAc7EL,WA1C4B3H,GAC1B,IAAIiI,EAAQJ,EAAU7H,GAOtB,OALKiI,IACHA,aAQF,IACE,MAAM,IAAI/H,MACV,MAAOgI,GACP,IAAIC,GAAW,GAAKD,EAAIjG,OAAOmG,MAAK,kCAEpC,GAAID,EAGF,OAAOL,EAAWK,EAAQ,IAI9B,MAAO,IApBGE,GACRR,EAAU7H,GAAMiI,GAGXA,GAoCTL,WAZmBG,GACjB,IAAII,GAAW,GAAKJ,GAAKK,MAAK,+BAE9B,IAAKD,EACH,MAAM,IAAIjI,MAAM,oBAGlB,OAAOiI,EAAQ,OC3CjBG,EAAiBnI,EAAA,SAAAoI,aAA6C,SAAWpI,EAAA,SAAAqI,QAA6C,aJgdtHC,iBArDeC,EAAKC,QACK,IAAVA,IACPA,EAAK,IAAAC,IAAAN,IAET,MAAMO,EAAU,CAChBA,IAAc,IACdA,EAAQC,IAAIC,6BAA+B,SAASC,GAEhD,OADUrI,EAAUqI,GAAMC,OAG9BJ,EAAQC,IAAII,8BAAgC,SAASF,GAEjD,OADUrI,EAAUqI,GAAMG,QAG9BN,EAAQC,IAAIM,4BAA8B,SAASJ,EAAMK,GACrD,IACIlD,WA1NevD,EAAK0G,GAC5B,MAAMzF,EAAMyF,EAAoB,EAAb1G,EAAI7C,QAGvB,OAFAqC,IAAkBY,IAAIJ,EAAKiB,EAAM,GACjC3B,EAAkBU,EAAI7C,OACf8D,EAsNQ0F,CADD5I,EAAU0I,GAAMG,KACQjK,EAAKkK,mBACnCC,EAAOxH,EACXkB,IAAkB4F,EAAO,EAAI,GAAKU,EAClCtG,IAAkB4F,EAAO,EAAI,GAAK7C,GAEtC0C,EAAQC,IAAIa,2BAA6B,SAASX,GAC9CjI,EAAWiI,IAEfH,EAAQC,IAAIc,kDAAoD,WAAa,OAAOpF,GAAY,SAAUwE,EAAMK,EAAMQ,EAAMC,GAExH,OAAOhG,EADG,IAAIiG,UAAU3F,EAA2B4E,EAAMK,GAAOQ,IAAS,EAAGC,IAAS,MAEtFE,YACHnB,EAAQC,IAAImB,wBAA0B,SAASjB,EAAMK,GACjD,IACIlD,WAxUevD,EAAK0G,EAAQY,GAEpC,QAAgBxJ,IAAZwJ,EAAuB,CACvB,MAAMpH,EAAMN,EAAkBO,OAAOH,GAC/BiB,EAAMyF,EAAOxG,EAAI/C,QAGvB,OAFAqC,IAAkBmC,SAASV,EAAKA,EAAMf,EAAI/C,QAAQiD,IAAIF,GACtDZ,EAAkBY,EAAI/C,OACf8D,EAGX,IAAIQ,EAAMzB,EAAI7C,OACV8D,EAAMyF,EAAOjF,GAEjB,MAAM8F,EAAM/H,IAEZ,IAAIgI,EAAS,EAEb,KAAOA,EAAS/F,EAAK+F,IAAU,CAC3B,MAAMC,EAAOzH,EAAI0H,WAAWF,GAC5B,GAAIC,EAAO,IAAM,MACjBF,EAAItG,EAAMuG,GAAUC,EAGxB,GAAID,IAAW/F,EAAK,CACD,IAAX+F,IACAxH,EAAMA,EAAI2H,MAAMH,IAEpBvG,EAAMqG,EAAQrG,EAAKQ,EAAKA,EAAM+F,EAAsB,EAAbxH,EAAI7C,QAC3C,MAAM8C,EAAOT,IAAkBmC,SAASV,EAAMuG,EAAQvG,EAAMQ,GAG5D+F,GAFY1H,EAAaE,EAAKC,GAEhBK,QAIlB,OADAhB,EAAkBkI,EACXvG,EAqSQ2G,CADDtJ,EAAYP,EAAU0I,IACE9J,EAAKkK,kBAAmBlK,EAAKkL,oBAC3Df,EAAOxH,EACXkB,IAAkB4F,EAAO,EAAI,GAAKU,EAClCtG,IAAkB4F,EAAO,EAAI,GAAK7C,GAEtC0C,EAAQC,IAAI4B,iBAAmB,SAAS1B,EAAMK,GAC1C,MAAM,IAAInJ,OA5RU2D,EA4RemF,EA5RV3E,EA4RgBgF,EA3RtC/F,EAAkBY,OAAO9B,IAAkBmC,SAASV,EAAKA,EAAMQ,UAD9CR,EAAKQ,IA+RR,iBAAVsE,GAA0C,mBAAZgC,SAA0BhC,aAAiBgC,SAA4B,mBAAR/B,KAAsBD,aAAiBC,OAC3ID,EAAQiC,MAAMjC,IAKlB,MAAOhF,SAACA,EAAQkH,OAAEA,wBA5EFA,EAAQhC,GACxB,GAAwB,mBAAbiC,UAA2BD,aAAkBC,SAAU,CAC9D,GAAgD,mBAArCC,YAAYC,qBACnB,IACI,aAAaD,YAAYC,qBAAqBH,EAAQhC,GAExD,MAAOhE,GACL,GAA0C,oBAAtCgG,EAAOI,QAAQC,IAAI,gBAInB,MAAMrG,EAHNsG,QAAQC,KAAK,oMAAqMvG,GAQ9N,MAAMwG,QAAcR,EAAOS,cAC3B,aAAaP,YAAYQ,YAAYF,EAAOxC,GAEzC,CACH,MAAMlF,QAAiBoH,YAAYQ,YAAYV,EAAQhC,GAEvD,OAAIlF,aAAoBoH,YAAYS,SACzB,UAAE7H,SAAUkH,GAGZlH,GAkDoB8H,OAAW9C,EAAOE,GAKrD,OAHAtJ,EAAOoE,EAAS+H,QAChBhD,EAAKiD,uBAAyBd,EAEvBtL,GK1aX,MAAMqM,EAA6B5J,IACjC,GAAoB,iBAAhBA,EAAQZ,KAAyB,CAEnC,MAAMyK,GLoJoBrC,EKpJCxH,EAAQwH,KLsJpB,KADXxI,EAAMzB,EAAKuM,cAAchI,EAAc0F,UACxB9I,EAAYkF,EAAKK,OAAOjF,IKpJ3C,MAAO,CACL+K,OAAQF,GAAQ,CACd9F,EAAG,CACD9B,EAAG4H,EAAK9F,EAAE9B,EACVuB,EAAGqG,EAAK9F,EAAEP,GAEZa,EAAG,CACDpC,EAAG4H,EAAKxF,EAAEpC,EACVuB,EAAGqG,EAAKxF,EAAEb,GAEZiB,EAAG,CACDxC,EAAG4H,EAAKpF,EAAExC,EACVuB,EAAGqG,EAAKpF,EAAEjB,GAEZqB,EAAG,CACD5C,EAAG4H,EAAKhF,EAAE5C,EACVuB,EAAGqG,EAAKhF,EAAErB,KAIX,GAAoB,oBAAhBxD,EAAQZ,KAA4B,CAC7C,MAAO2E,EAACA,EAACM,EAAEA,EAACI,EAAEA,EAACI,EAAEA,GAAM7E,EAAQgK,OACzBH,EAAO,IAAIjG,EAASG,EAAE9B,EAAG8B,EAAEP,EAAGa,EAAEpC,EAAGoC,EAAEb,EAAGiB,EAAExC,EAAGwC,EAAEjB,EAAGqB,EAAE5C,EAAG4C,EAAErB,GACzDuG,WL0IuBvC,EAAMwC,EAAQC,EAAcC,GACzDxI,EAAasI,EAAQpG,GACrB,IAAIO,EAAO6F,EAAOnI,IAGlB,OAFAmI,EAAOnI,IAAM,EAEN9C,EADGxB,EAAK4M,iBAAiBrI,EAAc0F,GAAOrD,EAAM8F,GAAejI,EAAWkI,GAAgBlI,EAAWkI,GAAiB,EAAIA,IK9ItHE,CAAiBpK,EAAQwH,KAAMqC,EAAM7J,EAAQqK,YAAarK,EAAQsK,cACjF,MAAO,QAAEP,EAAQQ,SAAU,CAACR,EAAOvC,KAAKnH,SACnC,GAAoB,YAAhBL,EAAQZ,KAAoB,CACrC,MAAO6H,MAACA,EAAKE,OAAEA,GAAWnH,EAAQwK,OAE5BC,EADS,IAAIC,gBAAgBzD,EAAOE,GACvBwD,WAAW,MAC9BF,EAAIG,UAAU5K,EAAQwK,OAAQ,EAAG,GACjC,MAAMT,EAASU,EAAII,aAAa,EAAG,EAAG5D,EAAOE,GAC7C,MAAO,QAAE4C,EAAQQ,SAAU,CAACR,EAAOvC,KAAKnH,SAExC,MAAM,IAAIyK,UAAU,uBLiHMtD,EACtBxI,GK9GR,IAAI+L,EAAOtE,IAAOuE,OAAK,SAEvBC,UAASC,MAASC,UACVJ,EACN,MAAOK,IAACA,KAAQ5D,GAAS2D,EAAI3D,KAC7B,IACE,MAAOuC,OAACA,EAAMQ,SAAEA,GAAaX,EAAOwB,GACpCC,YAAY,QAAEtB,KAAWvC,GAAQ+C,GAAY,IAC7C,MAAOrE,GACDA,aAAehI,QACnBgI,EAAM,IAAIhI,MAAK,4BAA6BgI,MAE9CmF,YAAY,CACVC,MAAO,CACLtL,QAAUkG,EAAclG,QACxBC,MAAQiG,EAAcjG,MACtBX,KAAO4G,EAAc5G,SAEpBkI,cC7FT+D,EAAiB,SAAUC,EAAWC,EAAQC,GAC5C,GAAID,IAAWE,KAAKC,SAASH,OAG3B,OAAOD,EAGP,IAAIK,EAASH,EAAQ,UAAYrN,KAAKyB,UAAU0L,GAAa,IAAM,iBAAmBnN,KAAKyB,UAAU0L,GAAa,KAClH,OAAO5E,IAAIkF,gBAAgB,IAAIC,KAAK,CAACF,GAAS,CAC5CzM,KAAM,8CCTZ,IAAI4M,EAAMC,EAAA1F,aAAuB,SAAWpI,EAAA,SAAAqI,QAA6C,SAAS0F,EAAiBX,EAAUS,EAAKC,EAAAE,UAAoBH,IAAM,GCA5J,MAAMI,EAAS,IAAS,IAAIC,OAAMH,EAAmD,CAAE9M,KAAM,WAEvFkN,EAA2B,GAEjC,GAAIC,UAAUC,oBACZ,IAAK,IAAI1O,EAAI,EAAGA,EAAIyO,UAAUC,sBAAuB1O,EACnDwO,EAAezN,KAAKuN,KAOxB,IAAIK,EAAY,EAEhB,MAAMC,EAAOxB,MAA6BE,EAAQb,IACzC,IAAIoC,SAAO,CAA0BnG,EAASoG,KACnD,MAAMC,EAPcP,EAAeQ,OAASV,IAQ5C,IAAIpO,EAAKyO,IAET,MAAMM,EAAa5B,IACjB,MAAQnN,GAAIgP,EAAG1B,MAAEA,EAAKvB,OAAEA,GAAWoB,EAAI3D,KACvC,GAAIwF,GAAOhP,EAAI,CACb,GAAIsN,EAAO,CACT,IAAIpF,EAAM,IAAIhI,MAAMoN,EAAMtL,SAC1BkG,EAAIjG,MAAQqL,EAAMrL,MAClBiG,EAAI5G,KAAOgM,EAAMhM,KACjBsN,EAAO1G,QAEPM,EAAQuD,GAlBA,CAAI8C,IAAmBP,EAAezN,KAAKgO,IAqBrDI,CAAaJ,GACbA,EAAOK,oBAAoB,UAAWH,KAG1CF,EAAOM,iBAAiB,UAAWJ,GACnCF,EAAOxB,YAAY,IAAErN,MAAIoN,GAAOb,GAAY,gBAIhC6C,EAAa5F,EAAiB+C,GAC5C,OAAOmC,EAAQ,CACbtN,KAAM,qBACNoI,GACC+C,EAAW,CAAC/C,EAAKA,KAAKnH,QAAU,IC/CrC,MAAMgN,EAAWtB,KAAK9I,UAAUqG,aAAe,WAC7C,OAAO,IAAIqD,SAAO,CAAEnG,EAASoG,KAC3B,MAAMU,EAAK,IAAIC,WACfD,EAAGE,OAAM,KACPhH,EAAQ8G,EAAGvD,SAEbuD,EAAGG,QAAO,KACRb,EAAOU,EAAGhC,QAEZgC,EAAGI,kBAAkB9K,UAIZ+K,EAAKzC,MAAU0C,IAC1B,MAAMC,EAA4C,GAClD,IAAIC,EAAQ,EACZ,MAAMC,EAAoB,GACpBC,EAASC,IACbJ,EAAUhP,KAAKoP,GACfH,GAASG,EAAMlQ,QAEXmQ,EAASD,IACbD,EAAM,KACNA,EAAMC,IAEFE,EAAUC,IACd,IAAI/L,EAAM,EACV,IAAK,MAAM4L,KAASG,EAAQ/L,GAAO4L,EAAMlQ,OACzC,MAAM+C,EAAM,IAAIP,WAAW8B,GAC3BA,EAAM,EACN,IAAK,MAAMgM,KAASD,EAAQ,CAC1B,GAAoB,iBAATC,EACT,IAAK,IAAIvQ,EAAI,EAAGA,EAAIuQ,EAAMtQ,SAAUD,EAAGgD,EAAIhD,EAAIuE,GAAOgM,EAAM/F,WAAWxK,QAEvEgD,EAAIE,IAAIqN,EAAOhM,GAEjBA,GAAOgM,EAAMtQ,OAEf,OAAO+C,GAGHwN,EAAWC,IACfP,EAAM,IAAMO,EAAU,OAElBC,EAAUvI,IAEdiI,EAAMjI,EAAMtG,aAkBRL,EAAQ2G,IAEZiI,EAAM,IAAMjI,IAERwI,EAASC,IACbR,EAAM,KACNQ,IACAR,EAAM,MAGFS,EAAQC,IACZV,EAAM,MACN,IAAK,MAAMW,KAAOD,EAChBtP,EAAKuP,GACLD,EAAOC,KAETX,EAAM,OAEFY,EAAM,CAAIC,EAAYR,KAI1BI,EAAKI,GACLb,EAAM,YACNF,EAAMO,GACNP,EAAM,cAEFgB,EAAUN,IACdV,EAAM,KACNA,EAAMD,EAAQlP,KAAKiP,GAAS,UAC5BY,IACAR,EAAM,UACCH,EAAQhQ,QAEXkR,EAAajR,IACjBkQ,EAAMlQ,EAAK,SAObsQ,EAAQ,WAERA,EAAQ,QACR,MAAMY,QAAcvC,QAAQwC,IAAIvB,EAAOwB,KAAGlE,MAAOmE,IAC/C,MAAMC,EAASC,SAASC,cAAc,UACtCF,EAAOrI,MAAQoI,EAAIpI,MACnBqI,EAAOnI,OAASkI,EAAIlI,OACpBmI,EAAO3E,WAAW,MAAO8E,aAAaJ,EAAK,EAAG,GAC9C,MAAMK,QAAa,IAAI/C,SAAQnG,GAAW8I,EAAOK,OAAOnJ,EAAS,gBAC3DoJ,EAAW,IAAIrP,iBAAiB8M,EAASzN,KAAK8P,IAC9CG,EAAQb,GAAM,KAClBF,EAAO,CACLgB,OACExQ,EAAK,YAEPyQ,UACEzQ,EAAK,UAEP0Q,QACExB,EAAOa,EAAIpI,QAEbgJ,SACEzB,EAAOa,EAAIlI,SAEb+I,aACE5Q,EAAK,cAEP6Q,mBACE3B,EAAO,IAET4B,SACE9Q,EAAK,cAEP+Q,SACE7B,EAAOoB,EAAS7R,UAEjB6R,MAIC3I,EADS,IACQoI,EAAIpI,MAAQoI,EAAIlI,OACjCmJ,EAAWtB,GAAM,KACrB,MAAMjF,EAAM,GAAM9C,yBAClB6H,EAAO,CACLuB,SACE7B,EAAOzE,EAAOhM,UAEfoQ,EAAO,CACRpE,QAmCJ,OAhCaiF,GAAM,KACjBL,EAAK,CACHmB,OACExQ,EAAK,SAEPiR,SACEtB,EAAUlB,EAAQhQ,OAAS,IAE7ByS,YACE7B,EAAK,CACH8B,UACE9B,EAAK,CACH+B,IACEzB,EAAUY,UAMpBc,WACE1B,EAAUqB,IAEZM,WACEnC,GAAK,KACHD,EAAO,GACPA,EAAO,GACPA,EAAOvH,GACPuH,EAvCO,kBA+CXqC,EAAW7B,GAAM,KACrBL,EAAK,CACHmB,OACExQ,EAAK,UAEPwR,OACErC,GAAK,KACH,IAAK,MAAMsC,KAAQ7B,EACjBD,EAAU8B,OAIhBC,QACExC,EAAOU,EAAMnR,cAKbkT,EAAUjC,GAAM,KACpBL,EAAK,CACHmB,OACExQ,EAAK,YAEP4R,QACEjC,EAAU4B,SAMhB7C,EAAM,MACN,MAAMmD,EAAarD,EACnBE,EAAM,YAAcD,EAAQhQ,OAAS,GAAK,2BAC1C,IAAK,MAAMqK,KAAU2F,EACnBC,EAAM5F,EAAOzI,WAAWyR,SAAS,GAAI,KAAO,eAY9C,OAVApD,EAAM,WACNW,EAAK,CACH0C,OACE7C,EAAOT,EAAQhQ,OAAS,IAE1BuT,OACErC,EAAUgC,MAGdjD,EAAM,gBAAkBmD,EAAa,WAC9BhD,EAAON,IChOV0D,EAAehC,SAASC,cAAc,UACtCgC,EAAYD,EAAa5G,WAAW,MAE7B8G,EAAOvG,MAAUmE,EAAqC9E,IAC7DgH,EAAyC,oCFyClB/G,EAAqBD,GAChD,OAAOmC,EAAQ,CACbtN,KAAM,kBACNoL,GACCD,EAAW,CAACC,GAAU,IE5ChBkH,CAAarC,aAAesC,YAActC,QAAYuC,kBAAkBvC,GAAM9E,IAEvFgH,EAAatK,MAAQoI,EAAIpI,MAAOsK,EAAapK,OAASkI,EAAIlI,OAC1DqK,EAAU5G,UAAUyE,EAAK,EAAG,GACrBmC,EAAU3G,aAAa,EAAG,EAAGwE,EAAIpI,MAAOoI,EAAIlI,eCvBrD0K,EAAiB1T,EAAA,SAAAoI,aAA6C,SAAWpI,EAAA,SAAAqI,QAA6C,eCAtHsL,EAAiB3T,EAAA,SAAAoI,aAA6C,SAAWpI,EAAA,SAAAqI,QAA6C,eCAtHuL,EAAiB5T,EAAA,SAAAoI,aAA6C,SAAWpI,EAAA,SAAAqI,QAA6C,eCAtHwL,EAAiB7T,EAAA,SAAAoI,aAA6C,SAAWpI,EAAA,SAAAqI,QAA6C,SCmB/G,IAAIyL,EAAeC,OAAOC,kBAEL,IAAjBF,IACTA,EAAY,MAMPhN,YACSmN,GACV,GAA8B,UAA1BA,EAAiBC,KACnB,MAAM,IAAIC,aAAa,qBAEzB1P,KAAK2P,kBAAoBH,EACnB,eAAgBxP,KAAK2P,oBAEzB3P,KAAK2P,kBAAkBC,WAAa,QAItC5P,KAAK6P,eAAiB,IAAIC,YAAY,CAACN,IACvCxP,KAAK+P,aAAepD,SAASC,cAAc,SAC3C5M,KAAKgQ,oBAAsB,IAAIjG,SAAQnG,IACrC5D,KAAK+P,aAAaxF,iBAAiB,UAAW3G,MAE5CqM,iBACFjQ,KAAK+P,aAAaG,UAAYlQ,KAAK6P,eAEnC7P,KAAK+P,aAAaI,IAAMnM,IAAIkF,gBAAgBlJ,KAAK6P,gBAEnD7P,KAAK+P,aAAaK,OAAQ,EAC1BpQ,KAAK+P,aAAaM,aAAa,cAAe,IAC9CrQ,KAAK+P,aAAaO,OAElBtQ,KAAKuQ,cAAgB5D,SAASC,cAAc,UAE5C5M,KAAKwQ,gBAAkBxQ,KAAKuQ,cAAcxI,WAAW,MAOnDyH,uBACF,OAAOxP,KAAK2P,kBASdc,uBACE,OAAO,IAAI1G,SAAQ,SAAqBnG,EAASoG,GAE/C,MAAM0G,EAAqB,CACzBC,QAAS,EAAGC,IAAK,EAAGC,IAAK,GAE3BjN,EAAQ,CACNkN,qBAAsBJ,EACtBK,aAAc,OACdC,cAAe,OACfC,UAAW,OACXC,YAAaR,EACbS,WAAYT,EACZU,IAAKV,EACLW,iBAAiB,EACjBC,iBAAkB,OAClBC,KAAMb,IAER1G,EAAO,IAAI0F,aAAa,sBAS5B8B,WAAWC,EAAgB,IACzB,OAAO,IAAI1H,SAAQ,SAAoBnG,EAASoG,OAWlD0H,YACE,MAAM3I,EAAO/I,KACb,OAAO,IAAI+J,SAAQ,SAAoBnG,EAASoG,GAG9C,GAA0C,SAAtCjB,EAAK4G,kBAAkBC,WACzB,OAAO5F,EAAO,IAAI0F,aAAa,sBAEjC3G,EAAKiH,oBAAoB2B,MAAI,KAC3B,IACE5I,EAAKwH,cAAclM,MAAQ0E,EAAKgH,aAAa6B,WAC7C7I,EAAKwH,cAAchM,OAASwE,EAAKgH,aAAa8B,YAC9C9I,EAAKyH,gBAAgBxI,UAAUe,EAAKgH,aAAc,EAAG,GACrDhH,EAAKwH,cAAcxD,OAAOnJ,GAC1B,MAAO8E,GACPsB,EAAO,IAAI0F,aAAa,wBAYhCoC,YACE,MAAM/I,EAAO/I,KACb,OAAO,IAAI+J,SAAQ,SAAoBnG,EAASoG,GAG9C,GAA0C,SAAtCjB,EAAK4G,kBAAkBC,WACzB,OAAO5F,EAAO,IAAI0F,aAAa,sBAEjC3G,EAAKiH,oBAAoB2B,MAAI,KAC3B,IACE5I,EAAKwH,cAAclM,MAAQ0E,EAAKgH,aAAa6B,WAC7C7I,EAAKwH,cAAchM,OAASwE,EAAKgH,aAAa8B,YAC9C9I,EAAKyH,gBAAgBxI,UAAUe,EAAKgH,aAAc,EAAG,GAErDnM,EAAQ0L,OAAON,kBAAkBjG,EAAKwH,gBACtC,MAAO7H,GACPsB,EAAO,IAAI0F,aAAa,2BAQpCJ,OAAOC,aAAeF,ECzJtB,MAAM0C,EAAOpF,SAASqF,eAAe,QAC/BC,EAAQtF,SAASqF,eAAe,SAChCE,EAAWvF,SAASqF,eAAe,YACnCG,GAAUxF,SAASqF,eAAe,WAClCI,GAAczF,SAASqF,eAAe,gBACtCK,GAAa1F,SAASqF,eAAe,eACrCM,GAAgB3F,SAASqF,eAAe,kBACxCO,GAAa5F,SAASqF,eAAe,eACrCQ,GAAgB7F,SAASqF,eAAe,yBACxCS,GAAS9F,SAASqF,eAAe,iBACjCU,GAAiB/F,SAASqF,eAAe,mBACzCW,GAAUhG,SAASqF,eAAe,WAClCY,GAAajG,SAASqF,eAAe,eACrCa,GAAgBlG,SAASqF,eAAe,kBACxCc,GAAenG,SAASqF,eAAe,iBACvCe,GAAQpG,SAASqF,eAAe,SAChCgB,GAAWrG,SAASqF,eAAe,aACnCiB,GAActG,SAASqF,eAAe,gBACtCkB,GAAOvG,SAASqF,eAAe,QAC/BmB,GAAgBxG,SAASqF,eAAe,kBACxCoB,GAASzG,SAASqF,eAAe,UACjCqB,GAAU1G,SAASqF,eAAe,WAClCsB,GAAc3G,SAASqF,eAAe,gBACtCuB,GAAO5G,SAASqF,eAAe,QAC/BwB,GAAqB7G,SAASqF,eAAe,wBAC7CyB,GAAqB9G,SAASqF,eAAe,wBAC7C0B,GAAc/G,SAASqF,eAAe,gBACtC2B,GAAmBhH,SAASqF,eAAe,sBAC3C4B,GAAYjH,SAASqF,eAAe,cAU1C,IAAI6B,GACAC,GAAsD,GAM1D,MAAMC,GAAgB,GAQhBC,GAAkC,GAElCC,GAAYC,IAChBF,GAAgB/X,KAAKiY,GACf,KACJF,GAAgBG,OAAOH,GAAgBI,QAAQF,GAAW,KAIxDG,GAAmB,KACvB,IAAK,MAAMH,KAAYF,GACrBE,KAIJ,IAAII,IAAM,EACVhF,OAAO/E,iBAAiB,UAAQ,KAC9BgK,aAAaD,IACbA,GAAME,WAAWH,GAAqB,OACrC,CAAEI,SAAS,IAEd,MA+BMC,GAAK,CAAIvT,EAAUwT,KACvB,MAAMC,EAAOjI,SAASC,cAAc,OAC9BiI,EAAMC,KAAKlE,IAAItB,OAAOyF,WAAYzF,OAAO0F,aAO/C,OANAJ,EAAKK,MAAM5Q,MAAc,IAANwQ,EAAa,KAChCD,EAAKK,MAAM1Q,OAAe,IAANsQ,EAAa,KACjCD,EAAKK,MAAMC,aAAqB,KAANL,EAAc,KACxCD,EAAKK,MAAME,gBAAkB,QAC7BP,EAAKK,MAAMG,SAAW,WACtBC,GAAYT,EAAMzT,EAAGwT,GACdC,GAGHS,GAAW,CAAIT,EAAsBzT,EAAUwT,KACnD,MAAME,EAAMC,KAAKlE,IAAItB,OAAOyF,WAAYzF,OAAO0F,aAC/CJ,EAAKK,MAAMK,IAAMnU,EAAEP,EAAI+T,EAAc,KAANE,EAAc,KAC7CD,EAAKK,MAAMM,KAAOpU,EAAE9B,EAAIsV,EAAc,KAANE,EAAc,MAG1CW,GAAI,CAAIrU,EAAUM,EAAUkT,KAChC,MAAMC,EAAOjI,SAASC,cAAc,OAMpC,OALAgI,EAAKK,MAAM1Q,OAAS,MACpBqQ,EAAKK,MAAME,gBAAkB,MAC7BP,EAAKK,MAAMG,SAAW,WACtBR,EAAKK,MAAMQ,gBAAkB,cAC7BC,GAAWd,EAAMzT,EAAGM,EAAGkT,GAChBC,GAGHc,GAAU,CAAId,EAAsBzT,EAAUM,EAAUkT,KAC5DC,EAAKK,MAAM5Q,MAAQyQ,KAAKa,MAAMxU,EAAE9B,EAAIoC,EAAEpC,EAAG8B,EAAEP,EAAIa,EAAEb,GAAK+T,EAAQ,KAC9DC,EAAKK,MAAMK,IAAMnU,EAAEP,EAAI+T,EAAQ,KAC/BC,EAAKK,MAAMM,KAAOpU,EAAE9B,EAAIsV,EAAQ,KAChCC,EAAKK,MAAMW,UAAS,UAAad,KAAKe,MAAMpU,EAAEb,EAAIO,EAAEP,EAAGa,EAAEpC,EAAI8B,EAAE9B,UAG3DyW,GAAexN,MAAU6H,IAC7B,IAAI1D,EAA2C7H,EAC/C,GAAIuL,aAAehH,KAAM,CACvB,MAAM8D,ONvJU3E,OAAUmE,IAC5B,MAAMmI,EAAOjI,SAASC,cAAc,OAC9BmJ,EAAS,IAAIhM,SAAO,CAAQnG,EAASoG,KACzC4K,EAAKhK,OAAM,KAAWhH,KACtBgR,EAAK/J,QAAUvH,IAAS0G,EAAO1G,OAKjC,OAHAsR,EAAKzE,IAAMnM,IAAIkF,gBAAgBuD,SACzBsJ,EACN/R,IAAIgS,gBAAgBpB,EAAKzE,KAClByE,GM8IeqB,CAAQ9F,GAC5B1D,EAAMQ,EACNrI,QAAaiK,EAAQ5B,OAChB,CACL,MAAMiJ,EAAMvJ,SAASC,cAAc,UACnCsJ,EAAI7R,MAAQ8L,EAAI9L,MAChB6R,EAAI3R,OAAS4L,EAAI5L,OACjB2R,EAAInO,WAAW,MAAOC,UAAUmI,EAAK,EAAG,GACxC1D,EAAMyJ,EACNtR,QAAaiK,EAAQsB,GAAK,GAE5B,MAAMlJ,QAAauD,EAAa5F,IAAS,CACvCzD,EAAG,CAAE9B,EAAG,EAAGuB,EAAGgE,EAAKL,QACnB9C,EAAG,CAAEpC,EAAG,EAAGuB,EAAG,GACdiB,EAAG,CAAExC,EAAGuF,EAAKP,MAAOzD,EAAG,GACvBqB,EAAG,CAAE5C,EAAGuF,EAAKP,MAAOzD,EAAGgE,EAAKL,SAExB4R,EAAchV,IACdA,EAAE9B,EAAI,EAAG8B,EAAE9B,EAAI,EACV8B,EAAE9B,EAAIuF,EAAKP,QAAOlD,EAAE9B,EAAIuF,EAAKP,OAClClD,EAAEP,EAAI,EAAGO,EAAEP,EAAI,EACVO,EAAEP,EAAIgE,EAAKL,SAAQpD,EAAEP,EAAIgE,EAAKL,SAMzC,OAJA4R,EAAWlP,EAAK9F,GAChBgV,EAAWlP,EAAKxF,GAChB0U,EAAWlP,EAAKpF,GAChBsU,EAAWlP,EAAKhF,GACT,KAAEwK,OAAK7H,OAAMqC,IAGhBmP,GAAa9N,MAAU+N,IAC3B,MAAMC,EAAUD,EAAK7J,KAAI2D,GAAOA,aAAehH,MAAQgH,aAAepB,YAAc+G,GAAgB3F,GAAOA,IACrGoG,EAAoC,GAC1C,IAAIC,EAAkB,CAAEnS,MAAO,EAAGE,OAAQ,GACtCkS,GAAY,EAChB,IAAK,MAAMtP,KAAUmP,EAAS,CAC5B,MAAMI,EAAUvP,GAAUmP,EAAQ,GAC5BK,EAASxP,GAAUmP,EAAQA,EAAQnb,OAAS,IAC3CsR,IAACA,EAAG7H,KAAEA,EAAIqC,KAAEA,SAAeE,EAC5ByP,EAAUjK,SAASC,cAAc,OACvCgK,EAAQ3B,MAAM4B,QAAU,OACxBD,EAAQ3B,MAAM6B,eAAiB,SAC/BF,EAAQ3B,MAAM8B,WAAa,SAC3BH,EAAQ3B,MAAM+B,SAAW,SACzBJ,EAAQ3B,MAAMgC,gBAAkB,SAChC,MAAMC,EAASvK,SAASC,cAAc,OACtCsK,EAAOjC,MAAMG,SAAW,WACxB8B,EAAOC,YAAY1K,GACnBmK,EAAQO,YAAYD,GACpBjF,EAAMgD,MAAM4B,QAAU,OACtB,MAAMO,EAActC,KAAKjE,IAAIjM,EAAKP,MAAOO,EAAKL,QAAUuQ,KAAKlE,IAAIhM,EAAKP,MAAOO,EAAKL,QAClF,IAAIoQ,EAAQ,EAAG0C,EAAO,EAAGC,EAAO,EAAGC,GAAa,EAC5CC,EAA8B,GAClC,MAAMC,EAAa,KACjB,IAAKF,EAAY,CACf,MAAOhC,KAACA,EAAID,IAAEA,GAAQ4B,EAAOQ,wBAC7BL,EAAO9B,EACP+B,EAAOhC,EACPiC,GAAa,IAGXI,EAAS,CAAIxH,EAAYyH,KAC7B,MAAMC,EAAKnD,GAAMvE,EAAKwE,GACtB,IAAImD,GAAS,EACb,MAAMC,EAAM,CAAIxP,EAA8BlJ,EAAWuB,KACnDiX,EAAGG,eAAiBd,GAClB3O,EAAI0P,QAAUJ,GAAOtP,EAAI0P,QAAUxL,GAAOqI,KAAKa,MAAMtW,EAAI8Q,EAAI9Q,EAAIsV,EAAO/T,EAAIuP,EAAIvP,EAAI+T,GAA2D,GAAlDG,KAAKlE,IAAItB,OAAOyF,WAAYzF,OAAO0F,gBAClIzM,EAAI2P,2BACJJ,GAAS,EACTK,EAAO9Y,EAAGuB,KAGZsW,EAAO5M,oBAAoB,YAAa8N,GACxClB,EAAO5M,oBAAoB,aAAc+N,GACzCnB,EAAO5M,oBAAoB,YAAagO,GACxCpB,EAAO5M,oBAAoB,YAAaiO,GACxCrB,EAAO5M,oBAAoB,UAAWkO,GACtCtB,EAAO5M,oBAAoB,WAAYkO,KAGrCL,EAAM,CAAI9Y,EAAWuB,KACzBuP,EAAI9Q,EAAIA,EAAIsV,EACZxE,EAAIvP,EAAIA,EAAI+T,EACZU,GAAYwC,EAAI1H,EAAKwE,GACrBiD,KAEIY,EAAI,KACRV,GAAS,GAELM,EAAenY,IACnBwX,IACAM,EAAO9X,EAAGA,EAAEwY,MAAQpB,EAAMpX,EAAEyY,MAAQpB,IAEtCJ,EAAO3M,iBAAiB,YAAa6N,GACrC,MAAMC,EAAgBpY,IACpB,MAAM0Y,EAAQ1Y,EAAE2Y,cAAc,GAC9BnB,IACAM,EAAO9X,EAAG0Y,EAAMF,MAAQpB,EAAMsB,EAAMD,MAAQpB,IAE9CJ,EAAO3M,iBAAiB,aAAc8N,GACtC,MAAMC,EAAerY,IACf6X,IACF7X,EAAE4Y,iBACFV,EAAOlY,EAAEwY,MAAQpB,EAAMpX,EAAEyY,MAAQpB,KAGrCJ,EAAO3M,iBAAiB,YAAa+N,GACrC,MAAMC,EAAetY,IACnB,GAAI6X,EAAQ,CACV,MAAMa,EAAQ1Y,EAAE2Y,cAAc,GAC9B3Y,EAAE4Y,iBACFV,EAAOQ,EAAMF,MAAQpB,EAAMsB,EAAMD,MAAQpB,KAM7C,OAHAJ,EAAO3M,iBAAiB,YAAagO,GACrCrB,EAAO3M,iBAAiB,UAAWiO,GACnCtB,EAAO3M,iBAAiB,WAAYiO,GAC7BX,GAEHiB,EAAU,KACd,IAAK,MAAMlE,KAAQ4C,EACjBN,EAAO6B,YAAYnE,GAErB,MAAMoE,EAAKxD,GAAKvO,EAAK9F,EAAG8F,EAAKxF,EAAGkT,GAC1BsE,EAAKzD,GAAKvO,EAAKxF,EAAGwF,EAAKpF,EAAG8S,GAC1BuE,EAAK1D,GAAKvO,EAAKpF,EAAGoF,EAAKhF,EAAG0S,GAC1BwE,EAAK3D,GAAKvO,EAAKhF,EAAGgF,EAAK9F,EAAGwT,GAChC6C,EAAY,CACVN,EAAOC,YAAY6B,GACnB9B,EAAOC,YAAY8B,GACnB/B,EAAOC,YAAY+B,GACnBhC,EAAOC,YAAYgC,GACnBjC,EAAOC,YAAYQ,EAAU1Q,EAAK9F,GAAC,KACjCuU,GAAWyD,EAAIlS,EAAKhF,EAAGgF,EAAK9F,EAAGwT,GAC/Be,GAAWsD,EAAI/R,EAAK9F,EAAG8F,EAAKxF,EAAGkT,OAEjCuC,EAAOC,YAAYQ,EAAU1Q,EAAKxF,GAAC,KACjCiU,GAAWsD,EAAI/R,EAAK9F,EAAG8F,EAAKxF,EAAGkT,GAC/Be,GAAWuD,EAAIhS,EAAKxF,EAAGwF,EAAKpF,EAAG8S,OAEjCuC,EAAOC,YAAYQ,EAAU1Q,EAAKpF,GAAC,KACjC6T,GAAWuD,EAAIhS,EAAKxF,EAAGwF,EAAKpF,EAAG8S,GAC/Be,GAAWwD,EAAIjS,EAAKpF,EAAGoF,EAAKhF,EAAG0S,OAEjCuC,EAAOC,YAAYQ,EAAU1Q,EAAKhF,GAAC,KACjCyT,GAAWwD,EAAIjS,EAAKpF,EAAGoF,EAAKhF,EAAG0S,GAC/Be,GAAWyD,EAAIlS,EAAKhF,EAAGgF,EAAK9F,EAAGwT,SAI/ByE,EAAqB,KACzB,MAAO/U,MAACA,EAAKE,OAAEA,GAAWmS,EAAU2C,GAAejC,EAAa,MAASZ,EACrEE,IACFD,EAAY6C,GAAYlC,GACxBZ,EAAkB,OAAEnS,SAAOE,GAC3BkP,GAAmBwB,MAAM5Q,MAAQoP,GAAmBwB,MAAM1Q,OAASoP,GAAiBsB,MAAM5Q,MAAQsP,GAAiBsB,MAAM1Q,OAAgE,MAAtDkS,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAuB,KACjMvB,GAAmBwB,MAAMsE,OAAS5F,GAAiBsB,MAAMsE,OAAgE,KAAtD9C,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAsB,KAChI9C,EAAS+C,MAAM5Q,MAAQ4N,EAAMgD,MAAM5Q,MAAQiL,OAAOyF,WAAa,KAC/D7C,EAAS+C,MAAM1Q,OAAS0N,EAAMgD,MAAM1Q,OAAS+K,OAAO0F,YAAc,KAClE/C,EAAMgD,MAAMuE,cAAgB/C,EAAY,MAAQ,SAChDvE,EAAS+C,MAAMuE,cAAgB/C,EAAY,SAAW,MAClDA,GACFjD,GAAmByB,MAAMuE,cAAgB,SACzChG,GAAmByB,MAAM1Q,OAAS+K,OAAO0F,YAAc,KACvDxB,GAAmByB,MAAM5Q,MAAQ,KAEjCmP,GAAmByB,MAAMuE,cAAgB,MACzChG,GAAmByB,MAAM1Q,OAAS,GAClCiP,GAAmByB,MAAM5Q,MAAQiL,OAAOyF,WAAa,OAGzD,MAAM0E,EAAWpV,EAAQ,KACnBqV,EAAYnV,EAAS,KAEvBkS,GACFhK,EAAIwI,MAAM5Q,MAAQ,GAClBoI,EAAIwI,MAAM1Q,OAASmV,EACnB/E,EAAQrF,OAAO0F,YAAcpQ,EAAKL,SAElCkI,EAAIwI,MAAM5Q,MAAQoV,EAClBhN,EAAIwI,MAAM1Q,OAAS,GACnBoQ,EAAQrF,OAAOyF,WAAanQ,EAAKP,OAEnCuS,EAAQ3B,MAAM5Q,MAAQuS,EAAQ3B,MAAM0E,SAAWF,EAC/C7C,EAAQ3B,MAAM1Q,OAASqS,EAAQ3B,MAAM2E,UAAYF,EACjDnC,GAAa,EACbuB,KAEFM,IACAlH,EAASiF,YAAYP,GACrB,MAAMiD,EAAY5F,GAASmF,GAC3B7C,EAAIta,MAAK6d,IACP,GAAIA,IACF/F,GAAM9X,KAAK,MAAE2I,OAAMqC,MAAMwF,IACzB6G,GAAY2B,MAAM8E,QAAU,GACxBpD,GAAQ,KACNlK,EAAIpI,MAAQoI,EAAIlI,QAClBkI,EAAIwI,MAAM1Q,OAAS0O,GAAYgC,MAAM1Q,OACrCkI,EAAIwI,MAAM5Q,MAAQ,KAElBoI,EAAIwI,MAAM1Q,OAAS,GACnBkI,EAAIwI,MAAM5Q,MAAQ4O,GAAYgC,MAAM5Q,OAE/B4O,GAAY+G,WAAa9G,IAC9BD,GAAY8F,YAAY9F,GAAY+G,WAEtC/G,GAAYkE,YAAY1K,GAG5BoN,IACA3H,EAAS6G,YAAYnC,MAIzB,OAAO,IAAI7M,SAAQnG,IACjB,MAAMqW,EAAM,IAASC,GAAO,GACtBC,EAAQ,IAASD,GAAO,GAC9BxG,GAAYnJ,iBAAiB,QAAS4P,GACtCvG,GAAUrJ,iBAAiB,QAAS0P,GACpC,MAAMC,EAAUJ,IACdlG,GAAUtJ,oBAAoB,QAAS2P,GACvCvG,GAAYpJ,oBAAoB,QAAS6P,GACzClI,EAAMgD,MAAM4B,QAAU,OACtB,IAAK,MAAMuD,KAAM7D,EACf6D,EAAGN,GAELlW,EAAQkW,QAKRR,GAAelC,GAAwB9H,OAAOyF,WAAczF,OAAO0F,YAAcoC,EAEjFiC,GAAc,CAAIjC,EAAqBiD,KAC3C,MAAM5D,EAAY6C,GAAYlC,GACxB7S,EAASkS,EAAYnH,OAAO0F,YAAcF,KAAKwF,MAAMxF,KAAKlE,IAAItB,OAAOyF,WAAaqC,EAAa9H,OAAO0F,YAAcqF,IAE1H,MAAO,OADO5D,EAAY3B,KAAKwF,MAAMxF,KAAKlE,IAAItB,OAAO0F,YAAcoC,EAAa9H,OAAOyF,WAAasF,IAAa/K,OAAOyF,kBACxGxQ,IAGZgW,GAAe,CAAChI,GAAYD,IAC5BkI,GAAW,CAAC1H,GAAcJ,GAAgBG,GAAeL,GAAeS,IACxEwH,GAAc,CAACnH,GAAaH,IAC5BuH,GAAWF,GAASjP,OAAOkP,GAAapH,IAExCsH,GAAWrS,MAAUsS,IACzB,MAAMC,OA3TO,CAAID,IACjB,MAAME,EAAqC,CACzCzW,MAAO,IACPE,OAAQ,IACRwW,WAAY,eAEd,GAAIH,EAAQ,CACV,GAAI9G,GAAO8G,GAAS,OAAO9G,GAAO8G,GAClCE,EAAYE,SAAW,CAAEC,MAAOL,QAC3B,GAAI/G,GACT,OAAOA,GAET,MAAMqH,EAAOvR,UAAUwR,aAAaC,aAAa,CAC/CC,MAAOP,IACNnJ,MAAK2J,IACN,MAAMC,EAAWD,EAAME,iBAAiB,GAAGC,cAC3C,IAAK,MAAMC,KAASJ,EAAMK,YACxBD,EAAME,OAIR,MAAO,OAFO9G,KAAKjE,IAAI0K,EAASlX,MAAQkX,EAAShX,eAClCuQ,KAAKlE,IAAI2K,EAASlX,MAAQkX,EAAShX,QAC1ByW,SAAUO,EAASP,aAO7C,OALIJ,EAAQ9G,GAAO8G,GAAUM,EACxBrH,GAAgBqH,EAAKvJ,MAAKpV,IAC7BuX,GAAOvX,EAAIye,UAAYE,EAChB3e,KAEF2e,GA+RcW,CAAUjB,GAC/B,IAAIxD,EAAcyD,EAAOxW,MAAQwW,EAAOtW,OACxC,MAAMkS,EAAY6C,GAAYlC,IACvB/S,MAACA,EAAKE,OAAEA,GAAW8U,GAAejC,EAAa,KAChDsC,EAAYnV,EAAS,KACrBkV,EAAWpV,EAAQ,KACzB+N,GAAY6C,MAAM5Q,MAAQ+N,GAAY6C,MAAM0E,SAAWF,EACvDrH,GAAY6C,MAAM1Q,OAAS6N,GAAY6C,MAAM2E,UAAYF,EACzD3H,EAAKkD,MAAM5Q,MAAQiL,OAAOyF,WAAa,KACvChD,EAAKkD,MAAM1Q,OAAS+K,OAAO0F,YAAc,KACzC,IAAK,MAAM8G,KAAevB,GACpB9D,GACFqF,EAAY7G,MAAMuE,cAAgB,SAClCsC,EAAY7G,MAAM1Q,OAAS+K,OAAO0F,YAAc,KAChD8G,EAAY7G,MAAM5Q,MAAQ,KAE1ByX,EAAY7G,MAAMuE,cAAgB,MAClCsC,EAAY7G,MAAM1Q,OAAS,GAC3BuX,EAAY7G,MAAM5Q,MAAQiL,OAAOyF,WAAa,MAGlD,IAAK,MAAMgH,KAAWvB,GACpBuB,EAAQ9G,MAAM5Q,MAAQ0X,EAAQ9G,MAAM1Q,OAAgE,KAAtDkS,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAsB,KAE7G,IAAK,MAAMgH,KAAcvB,GACvBuB,EAAW/G,MAAM5Q,MAAQ2X,EAAW/G,MAAM1Q,OAAgE,MAAtDkS,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAuB,KAEpH,IAAK,MAAMiH,KAAQvB,GACjBuB,EAAKhH,MAAMsE,OAAgE,KAAtD9C,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAsB,KAEpF3B,GAAQ4B,MAAM5Q,MAAQgP,GAAQ4B,MAAM1Q,OAAgE,KAAtDkS,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAsB,KAC3G,MAAMkH,EAAwE,MAAtDzF,EAAYnH,OAAOyF,WAAazF,OAAO0F,aAAuB,KACtF/B,GAAYgC,MAAMC,aAAegH,EACjCjJ,GAAYgC,MAAMkH,OAASD,EAAiB,eACxCzF,GACFtE,GAAQ8C,MAAM1Q,OAASmV,EACvBvH,GAAQ8C,MAAM5Q,MAAQ,GACtB0N,EAAKkD,MAAMuE,cAAgB,QAE3BrH,GAAQ8C,MAAM1Q,OAAS,GACvB4N,GAAQ8C,MAAM5Q,MAAQoV,EACtB1H,EAAKkD,MAAMuE,cAAgB,UAE7B,MAAMsB,EAAqC,CACzCzW,MAAOwW,EAAOxW,MACdE,OAAQsW,EAAOtW,OACfyW,SAAU,CAAEC,MAAOJ,EAAOG,WAEtB9O,QAAevC,UAAUwR,aAAaC,aAAa,CACvDC,MAAOP,IAEHsB,EAAalQ,EAAOsP,iBAAiB,GACrCa,EAAeD,EAAWE,kBAChCxJ,GAAamC,MAAM4B,QAAUwF,EAAaE,MAAQ,GAAK,OACvDpK,GAAQjC,UAAYhE,EACpB,IAAIsQ,EAAmB,GACvB,MAMMC,EAAU,KACd,MAAM9H,EAAQ8B,EAAYnH,OAAO0F,YAAc7C,GAAQN,YAAcvC,OAAOyF,WAAa5C,GAAQP,WAC3F8K,EAAUpU,UACd,IAAIrB,EACJ,MAAM0V,EAAKC,YAAYC,MACI,QAAvB5K,EAAMgD,MAAM4B,UACd5P,QAAauD,QAAmBqE,QAAciO,EAAIhL,cAAc,IAZnD,MACjB,IAAK,MAAM8C,KAAQ4H,EACjBnK,GAAW0G,YAAYnE,GAEzB4H,EAASrhB,OAAS,GAUhB4hB,IACyB,GAArBC,IACE/V,IACFuV,EAAW,CACTnK,GAAW8E,YAAY3B,GAAKvO,EAAK9F,EAAG8F,EAAKxF,EAAGkT,IAC5CtC,GAAW8E,YAAY3B,GAAKvO,EAAKxF,EAAGwF,EAAKpF,EAAG8S,IAC5CtC,GAAW8E,YAAY3B,GAAKvO,EAAKpF,EAAGoF,EAAKhF,EAAG0S,IAC5CtC,GAAW8E,YAAY3B,GAAKvO,EAAKhF,EAAGgF,EAAK9F,EAAGwT,MAGhDqI,EAAoBxI,WAAWkI,EAAY5H,KAAKjE,IAAI,IAAM+L,YAAYC,MAAQF,EAAI,MAGtFK,EAAoBxI,WAAWkI,EAAY,IAE7CvK,GAAQ5H,iBAAiB,iBAAkBkS,GAC3C,MAAMK,EAAM,IAAIvN,aAAa6M,GAC7B,IAAIa,EAA4C,yBAAvChiB,OAAOoF,UAAUtD,SAASC,KAAK8f,GACxCpK,GAAeuC,MAAM4B,QAAUoG,EAAK,GAAK,OACzCrK,GAAWzC,IAAM+M,EAAA/N,GACjB,MAAMgO,EAAc,KAClBF,GAAMA,EACNrK,GAAWzC,IAAW+M,EAALD,EAAK9N,EAAQC,IAEhCuD,GAAQpI,iBAAiB,QAAS4S,GAClC,IAAIH,GAAoB,EACxB,MAIMI,EAAc9U,UAClB,GAA6B,IAAzB+K,GAAQ4B,MAAM8E,QAAe,CAC/B1G,GAAQ4B,MAAM8E,QAAU,MAL1B5H,GAAQ8C,MAAM8E,QAAU,IACxBvF,YAAU,IAAOrC,GAAQ8C,MAAM8E,QAAU,IAAI,IAM3C,IACE,MAAMsD,EAAQJ,QAAWH,EAAIpL,kBAAoBoL,EAAIhL,kBAC/CsE,GAAc,CAACiH,IACrB,MAAOpd,IACToT,GAAQ4B,MAAM8E,QAAU,KAG5B1G,GAAQ9I,iBAAiB,QAAS6S,GAClC,IAAIb,GAAQ,EACZvJ,GAAS7C,IAAM+M,EAAAhO,GACf,MAAMoO,EAAYhV,UAChB,IACEiU,GAASA,QACHH,EAAWmB,iBAAiB,CAChCC,SAAU,CAAC,OAAEjB,MAEfvJ,GAAS7C,IAAc+M,EAARX,EAAQtN,EAAWC,GAClC,MAAOjP,MAGX,OADA8S,GAAMxI,iBAAiB,QAAS+S,GACzB,CACLtC,SAAUH,EAAOG,SACjByC,QACElJ,aAAayI,GACbA,GAAoB,EACpB3J,GAAQ/I,oBAAoB,QAAS8S,GACrCrK,GAAMzI,oBAAoB,QAASgT,GACnC3K,GAAQrI,oBAAoB,QAAS6S,GACrChL,GAAQ7H,oBAAoB,iBAAkBmS,GAC9CtK,GAAQuL,QACR,IAAK,MAAMhC,KAASxP,EAAOyP,YACzBD,EAAME,UAOFtT,WACV,IAAI4D,QAAeyO,GAAYgD,aAAaC,QAAQ,kBACpD,MAAMC,EAAU,KACd,IAAK,MAAMC,KAAUrL,GAAOsL,QAC1BD,EAAO7I,MAAM+I,WAAa,GAE5BvL,GAAOwL,gBAAgB,GAAGhJ,MAAM+I,WAAa,QAE/C,IAAK,MAAMpD,WAAgBjR,UAAUwR,aAAa+C,mBAChD,GAAmB,cAAftD,EAAOnL,KAAsB,CAC/B,MAAMqO,EAASnR,SAASC,cAAc,UACtCkR,EAAOza,MAAQuX,EAAOI,SACtB8C,EAAOK,MAAQvD,EAAOuD,MACtB1L,GAAO0E,YAAY2G,GAGvBrL,GAAOpP,MAAQ6I,EAAO8O,SACtB6C,IACA,MAAMO,EAAM9V,UACVuV,IACA3R,EAAOuR,QACPhL,GAAO4L,UAAW,EAClBV,aAAaW,QAAQ,gBAAiB7L,GAAOpP,OAC7C6I,QAAeyO,GAAYlI,GAAOpP,OAClCoP,GAAO4L,UAAW,GAEpB5L,GAAO8L,SAAWH,EAClBnK,GAASmK,GACThL,GAAOmL,SAAQjW,UACb+K,GAAQ4B,MAAM8E,QAAU,YAClB3D,GAAc,IAAIhD,GAAOoL,QAC/BnL,GAAQ4B,MAAM8E,QAAU,IAE1BxG,GAAKkL,QAAOnW,UACV,GAAIyL,GAAM5Y,OAAQ,KAChBmY,GAAY2B,MAAM8E,QAAU,MACrB9G,GAAY+G,WAAa9G,IAC9BD,GAAY8F,YAAY9F,GAAY+G,WNxiBvB,EAAI0E,EAAYhiB,KACnC,MAAMyG,EAAMa,IAAIkF,gBAAgBwV,GAC1BC,EAAKhS,SAASC,cAAc,KAClC+R,EAAGC,SAAWliB,EACdiiB,EAAGE,KAAO1b,EACVwb,EAAGG,QACH9a,IAAIgS,gBAAgB7S,IMoiBhB4b,CAAS,IAAI5V,KAAK,OAAO4B,QAAYhB,QAAQwC,IAAIwH,GAAMvH,KAAG,EAAG5H,KAACA,EAAIqC,KAAEA,cRlhB1CrC,EAAiBwC,EAAcK,EAAqBE,GAClF,OAAOmC,EAAQ,CACbtN,KAAM,wBACNoI,SACAwC,cACAK,GACCE,EAAW,CAAC/C,EAAKA,KAAKnH,QAAU,IQ4gBgDuhB,CAAgBpa,EAAMqC,EAAM,YAAY,WACvH8M,GAAM5Y,OAAS,IAGnB+X,GAAKuL,QAAOnW,UACV,GAAIyL,GAAM5Y,OAAQ,CAChB,MAAM8jB,EAAYlL,GAAMpO,QAExB,GADAoO,GAAM5Y,OAAS,SACHib,GAAc6I,GAAa,CACrClL,GAAM9X,QAAQgjB,GACd,MAAOxS,IAACA,GAAQwS,EAAUA,EAAU9jB,OAAS,OACzCsR,EAAIpI,MAAQoI,EAAIlI,QAClBkI,EAAIwI,MAAM1Q,OAAS0O,GAAYgC,MAAM1Q,OACrCkI,EAAIwI,MAAM5Q,MAAQ,KAElBoI,EAAIwI,MAAM1Q,OAAS,GACnBkI,EAAIwI,MAAM5Q,MAAQ4O,GAAYgC,MAAM5Q,OAE/B4O,GAAY+G,WAAa9G,IAC9BD,GAAY8F,YAAY9F,GAAY+G,WAEtC/G,GAAYkE,YAAY1K,OAMhCyS,UC/lBAC,GAAiB5jB,EAAA,SAAAoI,aAA6C,SAAW,WAAapI,EAAA,SAAAqI,QAA6C,SDkmBjI+F,UAAUyV,cAAc5jB,SAAQ2jB","sources":["pkg/scanner.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-0257e6470d726abe.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-977b082c9c71fd98.js","src/workers/process.ts","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/runtime-c9f9eae28134774d.js","src/process.ts","src/pdf.ts","src/io.ts","node_modules/@parcel/runtime-js/lib/runtime-dbfc9e53e40aa678.js","node_modules/@parcel/runtime-js/lib/runtime-add98d7edd44d601.js","node_modules/@parcel/runtime-js/lib/runtime-1b7da2110459322e.js","node_modules/@parcel/runtime-js/lib/runtime-cdc44a1819775168.js","node_modules/image-capture/src/imagecapture.js","src/index.ts","node_modules/@parcel/runtime-js/lib/runtime-539dc03438dc10d0.js"],"sourcesContent":["\nlet wasm;\n\nconst heap = new Array(32).fill(undefined);\n\nheap.push(undefined, null, true, false);\n\nfunction getObject(idx) { return heap[idx]; }\n\nlet heap_next = heap.length;\n\nfunction dropObject(idx) {\n    if (idx < 36) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\n\nfunction debugString(val) {\n    // primitive types\n    const type = typeof val;\n    if (type == 'number' || type == 'boolean' || val == null) {\n        return  `${val}`;\n    }\n    if (type == 'string') {\n        return `\"${val}\"`;\n    }\n    if (type == 'symbol') {\n        const description = val.description;\n        if (description == null) {\n            return 'Symbol';\n        } else {\n            return `Symbol(${description})`;\n        }\n    }\n    if (type == 'function') {\n        const name = val.name;\n        if (typeof name == 'string' && name.length > 0) {\n            return `Function(${name})`;\n        } else {\n            return 'Function';\n        }\n    }\n    // objects\n    if (Array.isArray(val)) {\n        const length = val.length;\n        let debug = '[';\n        if (length > 0) {\n            debug += debugString(val[0]);\n        }\n        for(let i = 1; i < length; i++) {\n            debug += ', ' + debugString(val[i]);\n        }\n        debug += ']';\n        return debug;\n    }\n    // Test for built-in\n    const builtInMatches = /\\[object ([^\\]]+)\\]/.exec(toString.call(val));\n    let className;\n    if (builtInMatches.length > 1) {\n        className = builtInMatches[1];\n    } else {\n        // Failed to match the standard '[object ClassName]'\n        return toString.call(val);\n    }\n    if (className == 'Object') {\n        // we're a user defined class or Object\n        // JSON.stringify avoids problems with cycles, and is generally much\n        // easier than looping through ownProperties of `val`.\n        try {\n            return 'Object(' + JSON.stringify(val) + ')';\n        } catch (_) {\n            return 'Object';\n        }\n    }\n    // errors\n    if (val instanceof Error) {\n        return `${val.name}: ${val.message}\\n${val.stack}`;\n    }\n    // TODO we could test for more things here, like `Set`s and `Map`s.\n    return className;\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nlet cachedTextEncoder = new TextEncoder('utf-8');\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length);\n        getUint8Memory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len);\n\n    const mem = getUint8Memory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3);\n        const view = getUint8Memory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachegetInt32Memory0 = null;\nfunction getInt32Memory0() {\n    if (cachegetInt32Memory0 === null || cachegetInt32Memory0.buffer !== wasm.memory.buffer) {\n        cachegetInt32Memory0 = new Int32Array(wasm.memory.buffer);\n    }\n    return cachegetInt32Memory0;\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n\nfunction _assertClass(instance, klass) {\n    if (!(instance instanceof klass)) {\n        throw new Error(`expected instance of ${klass.name}`);\n    }\n    return instance.ptr;\n}\n\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n\n    heap[idx] = obj;\n    return idx;\n}\n/**\n* @param {ImageData} data\n* @returns {Quad | undefined}\n*/\nexport function find_document(data) {\n    var ret = wasm.find_document(addHeapObject(data));\n    return ret === 0 ? undefined : Quad.__wrap(ret);\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n/**\n* @param {ImageData} data\n* @param {Quad} region\n* @param {number} target_width\n* @param {number | undefined} target_height\n* @returns {ImageData}\n*/\nexport function extract_document(data, region, target_width, target_height) {\n    _assertClass(region, Quad);\n    var ptr0 = region.ptr;\n    region.ptr = 0;\n    var ret = wasm.extract_document(addHeapObject(data), ptr0, target_width, !isLikeNone(target_height), isLikeNone(target_height) ? 0 : target_height);\n    return takeObject(ret);\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1);\n    getUint8Memory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nlet cachegetUint8ClampedMemory0 = null;\nfunction getUint8ClampedMemory0() {\n    if (cachegetUint8ClampedMemory0 === null || cachegetUint8ClampedMemory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8ClampedMemory0 = new Uint8ClampedArray(wasm.memory.buffer);\n    }\n    return cachegetUint8ClampedMemory0;\n}\n\nfunction getClampedArrayU8FromWasm0(ptr, len) {\n    return getUint8ClampedMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        wasm.__wbindgen_exn_store(addHeapObject(e));\n    }\n}\n/**\n*/\nexport class Point {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Point.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    __destroy_into_raw() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_point_free(ptr);\n    }\n    /**\n    */\n    get x() {\n        var ret = wasm.__wbg_get_point_x(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set x(arg0) {\n        wasm.__wbg_set_point_x(this.ptr, arg0);\n    }\n    /**\n    */\n    get y() {\n        var ret = wasm.__wbg_get_point_y(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set y(arg0) {\n        wasm.__wbg_set_point_y(this.ptr, arg0);\n    }\n}\n/**\n*/\nexport class Quad {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Quad.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    __destroy_into_raw() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_quad_free(ptr);\n    }\n    /**\n    */\n    get a() {\n        var ret = wasm.__wbg_get_quad_a(this.ptr);\n        return Point.__wrap(ret);\n    }\n    /**\n    * @param {Point} arg0\n    */\n    set a(arg0) {\n        _assertClass(arg0, Point);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_quad_a(this.ptr, ptr0);\n    }\n    /**\n    */\n    get b() {\n        var ret = wasm.__wbg_get_quad_b(this.ptr);\n        return Point.__wrap(ret);\n    }\n    /**\n    * @param {Point} arg0\n    */\n    set b(arg0) {\n        _assertClass(arg0, Point);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_quad_b(this.ptr, ptr0);\n    }\n    /**\n    */\n    get c() {\n        var ret = wasm.__wbg_get_quad_c(this.ptr);\n        return Point.__wrap(ret);\n    }\n    /**\n    * @param {Point} arg0\n    */\n    set c(arg0) {\n        _assertClass(arg0, Point);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_quad_c(this.ptr, ptr0);\n    }\n    /**\n    */\n    get d() {\n        var ret = wasm.__wbg_get_quad_d(this.ptr);\n        return Point.__wrap(ret);\n    }\n    /**\n    * @param {Point} arg0\n    */\n    set d(arg0) {\n        _assertClass(arg0, Point);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_quad_d(this.ptr, ptr0);\n    }\n    /**\n    * @param {number} ax\n    * @param {number} ay\n    * @param {number} bx\n    * @param {number} by\n    * @param {number} cx\n    * @param {number} cy\n    * @param {number} dx\n    * @param {number} dy\n    */\n    constructor(ax, ay, bx, by, cx, cy, dx, dy) {\n        var ret = wasm.quad_new(ax, ay, bx, by, cx, cy, dx, dy);\n        return Quad.__wrap(ret);\n    }\n}\n\nasync function load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nasync function init(input) {\n    if (typeof input === 'undefined') {\n        input = new URL('scanner_bg.wasm', import.meta.url);\n    }\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_width_16bd64d09cbf5661 = function(arg0) {\n        var ret = getObject(arg0).width;\n        return ret;\n    };\n    imports.wbg.__wbg_height_368bb86c37d51bc9 = function(arg0) {\n        var ret = getObject(arg0).height;\n        return ret;\n    };\n    imports.wbg.__wbg_data_1ae7496c58caf755 = function(arg0, arg1) {\n        var ret = getObject(arg1).data;\n        var ptr0 = passArray8ToWasm0(ret, wasm.__wbindgen_malloc);\n        var len0 = WASM_VECTOR_LEN;\n        getInt32Memory0()[arg0 / 4 + 1] = len0;\n        getInt32Memory0()[arg0 / 4 + 0] = ptr0;\n    };\n    imports.wbg.__wbindgen_object_drop_ref = function(arg0) {\n        takeObject(arg0);\n    };\n    imports.wbg.__wbg_newwithu8clampedarrayandsh_1b8c6e1bede43657 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        var ret = new ImageData(getClampedArrayU8FromWasm0(arg0, arg1), arg2 >>> 0, arg3 >>> 0);\n        return addHeapObject(ret);\n    }, arguments) };\n    imports.wbg.__wbindgen_debug_string = function(arg0, arg1) {\n        var ret = debugString(getObject(arg1));\n        var ptr0 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len0 = WASM_VECTOR_LEN;\n        getInt32Memory0()[arg0 / 4 + 1] = len0;\n        getInt32Memory0()[arg0 / 4 + 0] = ptr0;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    if (typeof input === 'string' || (typeof Request === 'function' && input instanceof Request) || (typeof URL === 'function' && input instanceof URL)) {\n        input = fetch(input);\n    }\n\n\n\n    const { instance, module } = await load(await input, imports);\n\n    wasm = instance.exports;\n    init.__wbindgen_wasm_module = module;\n\n    return wasm;\n}\n\nexport default init;\n\n","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"d3X8m\\\":\\\"index.3b2fec53.js\\\",\\\"8plmg\\\":\\\"scanner_bg.52ddf46a.wasm\\\",\\\"hSxXa\\\":\\\"process.91b28c2d.js\\\",\\\"9Zhps\\\":\\\"flash.7ae5cfb8.svg\\\",\\\"aPRWI\\\":\\\"flash-off.f95884b2.svg\\\",\\\"iiC8o\\\":\\\"hd.0cfe4ff9.svg\\\",\\\"8qWZp\\\":\\\"sd.25c2f123.svg\\\",\\\"HMBE2\\\":\\\"service.js\\\"}\"));","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"8plmg\");","import init, { find_document, extract_document, Quad as WasmQuad } from '../../pkg/scanner';\n\nexport type Point = {\n  x: number;\n  y: number;\n}\n\nexport type Quad = {\n  a: Point;\n  b: Point;\n  c: Point;\n  d: Point;\n};\n\nexport type Messages = {\n  'find-document': [{\n    data: ImageData;\n  }, Quad | undefined];\n  'extract-document': [{\n    data: ImageData;\n    region: Quad;\n    targetWidth: number;\n    targetHeight?: number;\n  }, ImageData];\n  'get-data': [{\n    bitmap: ImageBitmap;\n  }, ImageData];\n};\n\nexport type Message = {\n  [T in keyof Messages]: {\n    type: T;\n  } & Messages[T][0];\n}[keyof Messages];\n\nconst handle = <T extends Message>(message: T): { result: Messages[T['type']][1]; transfer?: Transferable[] } => {\n  if (message.type == 'find-document') {\n    // const ts = performance.now();\n    const quad = find_document(message.data);\n    // console.log('find_document:', (performance.now() - ts) + 'ms')\n    return {\n      result: quad && {\n        a: {\n          x: quad.a.x,\n          y: quad.a.y\n        },\n        b: {\n          x: quad.b.x,\n          y: quad.b.y\n        },\n        c: {\n          x: quad.c.x,\n          y: quad.c.y\n        },\n        d: {\n          x: quad.d.x,\n          y: quad.d.y\n        }\n      }\n    };\n  } else if (message.type == 'extract-document') {\n    const { a, b, c, d } = message.region;\n    const quad = new WasmQuad(a.x, a.y, b.x, b.y, c.x, c.y, d.x, d.y);\n    const result = extract_document(message.data, quad, message.targetWidth, message.targetHeight);\n    return { result, transfer: [result.data.buffer] };\n  } else if (message.type == 'get-data') {\n    const { width, height } = message.bitmap;\n    const canvas = new OffscreenCanvas(width, height);\n    const ctx = canvas.getContext('2d')!;\n    ctx.drawImage(message.bitmap, 0, 0);\n    const result = ctx.getImageData(0, 0, width, height)\n    return { result, transfer: [result.data.buffer] };\n  } else {\n    throw new TypeError('invalid message');\n  }\n}\n\nlet load = init().catch(() => {});\n\nonmessage = async evt => {\n  await load;\n  const { msg, ...data } = evt.data;\n  try {\n    const { result, transfer } = handle(msg as Message);\n    postMessage({ result, ...data }, transfer || []);\n  } catch (err) {\n    if (!(err instanceof Error)) {\n      err = new Error(`Error in process worker: ${err}`);\n    }\n    postMessage({\n      error: {\n        message: (err as Error).message,\n        stack: (err as Error).stack,\n        name: (err as Error).name\n      },\n      ...data\n    });\n  }\n};","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"hSxXa\");module.exports = workerURL(url, bundleURL.getOrigin(url), true);","import { Message, Messages, Quad, Point } from './workers/process';\n\nconst newWorker = () => new Worker(new URL('./workers/process.ts', import.meta.url), { type: 'module' });\n\nconst processWorkers: Worker[] = [];\n\nif (navigator.hardwareConcurrency) {\n  for (let i = 1; i < navigator.hardwareConcurrency; ++i) {\n    processWorkers.push(newWorker());\n  }\n}\n\nconst getWorker = () => processWorkers.pop() || newWorker();\nconst returnWorker = (worker: Worker) => processWorkers.push(worker);\n\nlet messageID = 0;\n\nconst message = async <T extends Message>(msg: T, transfer?: Transferable[]) => {\n  return new Promise<Messages[T['type']][1]>((resolve, reject) => {\n    const worker = getWorker();\n    let id = messageID++;\n    // const ts = performance.now();\n    const onMessage = (evt: MessageEvent) => {\n      const { id: mid, error, result } = evt.data;\n      if (mid == id) {\n        if (error) {\n          let err = new Error(error.message);\n          err.stack = error.stack;\n          err.name = error.name;\n          reject(err);\n        } else {\n          resolve(result);\n        }\n        // console.log('Processed', msg, 'in', (performance.now() - ts) + 'ms', { result, error });\n        returnWorker(worker);\n        worker.removeEventListener('message', onMessage);\n      }\n    };\n    worker.addEventListener('message', onMessage);\n    worker.postMessage({ id, msg }, transfer || []);\n  })\n}\n\nexport function findDocument(data: ImageData, transfer?: boolean) {\n  return message({\n    type: 'find-document',\n    data\n  }, transfer ? [data.data.buffer] : []);\n}\n\nexport function extractDocument(data: ImageData, region: Quad, targetWidth: number, transfer?: boolean) {\n  return message({\n    type: 'extract-document',\n    data,\n    region,\n    targetWidth\n  }, transfer ? [data.data.buffer] : []);\n}\n\nexport function bitmapToData(bitmap: ImageBitmap, transfer?: boolean) {\n  return message({\n    type: 'get-data',\n    bitmap\n  }, transfer ? [bitmap] : []);\n}\n\nexport { Quad, Point }","const readFile = Blob.prototype.arrayBuffer || function(this: Blob) {\n  return new Promise((resolve, reject) => {\n    const fr = new FileReader();\n    fr.onload = () => {\n      resolve(fr.result as ArrayBuffer);\n    };\n    fr.onerror = () => {\n      reject(fr.error);\n    };\n    fr.readAsArrayBuffer(this);\n  })\n}\n\nexport const toPDF = async (images: ImageData[]) => {\n  const pdfChunks: (string | ArrayLike<number>)[] = [];\n  let index = 0;\n  const offsets: number[] = [];\n  const write = (chunk: string | ArrayLike<number>) => {\n    pdfChunks.push(chunk);\n    index += chunk.length;\n  }\n  const token = (chunk: string | ArrayLike<number>) => {\n    write(' ');\n    write(chunk);\n  }\n  const concat = (chunks: (string | ArrayLike<number>)[]) => {\n    let len = 0;\n    for (const chunk of chunks) len += chunk.length;\n    const buf = new Uint8Array(len);\n    len = 0;\n    for (const chunk of chunks) {\n      if (typeof chunk == 'string') {\n        for (let i = 0; i < chunk.length; ++i) buf[i + len] = chunk.charCodeAt(i);\n      } else {\n        buf.set(chunk, len);\n      }\n      len += chunk.length;\n    }\n    return buf;\n  }\n  // Convenience functions\n  const comment = (content: string) => {\n    write(\"%\" + content + '\\n');\n  }\n  const number = (value: number) => {\n    // Note: this doesnt work for very small and very large numbers\n    token(value.toString());\n  }\n  const ascii = (value: string) => {\n    token('(' + value.replace(/[\\n\\r\\t\\f\\b\\(\\)\\\\]/g, c => '\\\\00' + c.charCodeAt(0).toString(8)) + ')');\n  }\n  const bin = (value: string | ArrayLike<number>) => {\n    let data = '<';\n    if (typeof value == 'string') {\n      for (let i = 0; i < value.length; ++i) {\n        data += value.charCodeAt(i).toString(16);\n      }\n    } else {\n      for (let i = 0; i < value.length; ++i) {\n        data += value[i].toString(16);\n      }\n    }\n    token(data + '>');\n  };\n  const name = (value: string) => {\n    // Note: only supports ASCII names\n    token('/' + value);\n  };\n  const array = (fn: () => void) => {\n    token('[');\n    fn();\n    token(']');\n  };\n  type Dict = Record<string, () => void>;\n  const dict = (values: Dict) => {\n    token('<<');\n    for (const key in values) {\n      name(key);\n      values[key]();\n    }\n    token('>>');\n  };\n  const stream = (desc: Dict, content: ArrayLike<number>) => {\n    if (process.env.NODE_ENV != 'production') {\n      if (!desc['Length']) throw new TypeError('need stream length');\n    }\n    dict(desc);\n    token('stream\\n');\n    write(content);\n    write('endstream');\n  };\n  const object = (fn: () => void) => {\n    write(' ');\n    write(offsets.push(index) + ' 0 obj');\n    fn();\n    token('endobj');\n    return offsets.length;\n  };\n  const reference = (id: number) => {\n    token(id + ' 0 R');\n  }\n  const nullObject = () => {\n    token('null');\n  };\n\n  // v1.4 for compatibility\n  comment('PDF-1.4');\n    // 4 byte binary comment, as suggested by spec\n  comment('\\x90\\x85\\xfa\\xe3');\n  const pages = await Promise.all(images.map(async img => {\n    const canvas = document.createElement('canvas');\n    canvas.width = img.width;\n    canvas.height = img.height;\n    canvas.getContext('2d')!.putImageData(img, 0, 0);\n    const jpeg = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));\n    const jpegData = new Uint8Array(await readFile.call(jpeg));\n    const image = object(() => {\n      stream({\n        Type() {\n          name('XObject');\n        },\n        Subtype() {\n          name('Image');\n        },\n        Width() {\n          number(img.width);\n        },\n        Height() {\n          number(img.height);\n        },\n        ColorSpace() {\n          name('DeviceRGB');\n        },\n        BitsPerComponent() {\n          number(8);\n        },\n        Filter() {\n          name('DCTDecode');\n        },\n        Length() {\n          number(jpegData.length);\n        }\n      }, jpegData);\n    });\n    // US Letter width\n    const height = 792;\n    const width = height * img.width / img.height;\n    const contents = object(() => {\n      const result = `${width} 0 0 ${height} 0 0 cm /I Do`;\n      stream({\n        Length() {\n          number(result.length);\n        }\n      }, concat([\n        result\n      ]));\n    });\n    const page = object(() => {\n      dict({\n        Type() {\n          name('Page')\n        },\n        Parent() {\n          reference(offsets.length + 1);\n        },\n        Resources() {\n          dict({\n            XObject() {\n              dict({\n                I() {\n                  reference(image);\n                }\n              });\n            }\n          });\n        },\n        Contents() {\n          reference(contents);\n        },\n        MediaBox() {\n          array(() => {\n            number(0);\n            number(0);\n            number(width);\n            number(height);\n          });\n        }\n      });\n    });\n    return page;\n  }));\n\n  const pageRoot = object(() => {\n    dict({\n      Type() {\n        name('Pages');\n      },\n      Kids() {\n        array(() => {\n          for (const page of pages) {\n            reference(page);\n          }\n        });\n      },\n      Count() {\n        number(pages.length);\n      }\n    })\n  });\n\n  const catalog = object(() => {\n    dict({\n      Type() {\n        name('Catalog');\n      },\n      Pages() {\n        reference(pageRoot);\n      }\n    });\n  });\n\n  // XREF\n  write('\\n');\n  const xrefOffset = index;\n  write('xref\\n0 ' + (offsets.length + 1) + '\\n0000000000 65535 f \\n');\n  for (const offset of offsets) {\n    write(offset.toString().padStart(10, '0') + ' 00000 n \\n');\n  }\n  write('trailer');\n  dict({\n    Size() {\n      number(offsets.length + 1);\n    },\n    Root() {\n      reference(catalog);\n    }\n  });\n  write('\\nstartxref\\n' + xrefOffset + '\\n%%EOF');\n  return concat(pdfChunks);\n}","import { bitmapToData } from './process';\n\nexport const toImage = async (img: Blob) => {\n  const elem = document.createElement('img');\n  const loaded = new Promise<void>((resolve, reject) => {\n    elem.onload = () => { resolve(); };\n    elem.onerror = err => { reject(err); };\n  });\n  elem.src = URL.createObjectURL(img);\n  await loaded;\n  URL.revokeObjectURL(elem.src);\n  return elem;\n}\n\nconst sharedCanvas = document.createElement('canvas');\nconst sharedCtx = sharedCanvas.getContext('2d')!\n\nexport const getData = async (img: ImageBitmap | HTMLImageElement, transfer?: boolean) => {\n  if (sharedCanvas['transferControlToOffscreen' as 'getContext']) {\n    return bitmapToData(img instanceof ImageBitmap ? img : await createImageBitmap(img), transfer);\n  }\n  sharedCanvas.width = img.width, sharedCanvas.height = img.height;\n  sharedCtx.drawImage(img, 0, 0);\n  return sharedCtx.getImageData(0, 0, img.width, img.height);\n}\n\nexport const download = (file: Blob, name: string) => {\n  const url = URL.createObjectURL(file);\n  const el = document.createElement('a');\n  el.download = name;\n  el.href = url;\n  el.click();\n  URL.revokeObjectURL(url);\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"9Zhps\");","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"aPRWI\");","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"iiC8o\");","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + require('./helpers/bundle-manifest').resolve(\"8qWZp\");","/**\n * MediaStream ImageCapture polyfill\n *\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport let ImageCapture = window.ImageCapture;\n\nif (typeof ImageCapture === 'undefined') {\n  ImageCapture = class {\n\n    /**\n     * TODO https://www.w3.org/TR/image-capture/#constructors\n     *\n     * @param {MediaStreamTrack} videoStreamTrack - A MediaStreamTrack of the 'video' kind\n     */\n    constructor(videoStreamTrack) {\n      if (videoStreamTrack.kind !== 'video')\n        throw new DOMException('NotSupportedError');\n\n      this._videoStreamTrack = videoStreamTrack;\n      if (!('readyState' in this._videoStreamTrack)) {\n        // Polyfill for Firefox\n        this._videoStreamTrack.readyState = 'live';\n      }\n\n      // MediaStream constructor not available until Chrome 55 - https://www.chromestatus.com/feature/5912172546752512\n      this._previewStream = new MediaStream([videoStreamTrack]);\n      this.videoElement = document.createElement('video');\n      this.videoElementPlaying = new Promise(resolve => {\n        this.videoElement.addEventListener('playing', resolve);\n      });\n      if (HTMLMediaElement) {\n        this.videoElement.srcObject = this._previewStream;  // Safari 11 doesn't allow use of createObjectURL for MediaStream\n      } else {\n        this.videoElement.src = URL.createObjectURL(this._previewStream);\n      }\n      this.videoElement.muted = true;\n      this.videoElement.setAttribute('playsinline', ''); // Required by Safari on iOS 11. See https://webkit.org/blog/6784\n      this.videoElement.play();\n\n      this.canvasElement = document.createElement('canvas');\n      // TODO Firefox has https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas\n      this.canvas2dContext = this.canvasElement.getContext('2d');\n    }\n\n    /**\n     * https://w3c.github.io/mediacapture-image/index.html#dom-imagecapture-videostreamtrack\n     * @return {MediaStreamTrack} The MediaStreamTrack passed into the constructor\n     */\n    get videoStreamTrack() {\n      return this._videoStreamTrack;\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-getphotocapabilities\n     * @return {Promise<PhotoCapabilities>} Fulfilled promise with\n     * [PhotoCapabilities](https://www.w3.org/TR/image-capture/#idl-def-photocapabilities)\n     * object on success, rejected promise on failure\n     */\n    getPhotoCapabilities() {\n      return new Promise(function executorGPC(resolve, reject) {\n        // TODO see https://github.com/w3c/mediacapture-image/issues/97\n        const MediaSettingsRange = {\n          current: 0, min: 0, max: 0,\n        };\n        resolve({\n          exposureCompensation: MediaSettingsRange,\n          exposureMode: 'none',\n          fillLightMode: 'none',\n          focusMode: 'none',\n          imageHeight: MediaSettingsRange,\n          imageWidth: MediaSettingsRange,\n          iso: MediaSettingsRange,\n          redEyeReduction: false,\n          whiteBalanceMode: 'none',\n          zoom: MediaSettingsRange,\n        });\n        reject(new DOMException('OperationError'));\n      });\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-setoptions\n     * @param {Object} photoSettings - Photo settings dictionary, https://www.w3.org/TR/image-capture/#idl-def-photosettings\n     * @return {Promise<void>} Fulfilled promise on success, rejected promise on failure\n     */\n    setOptions(photoSettings = {}) {\n      return new Promise(function executorSO(resolve, reject) {\n        // TODO\n      });\n    }\n\n    /**\n     * TODO\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-takephoto\n     * @return {Promise<Blob>} Fulfilled promise with [Blob](https://www.w3.org/TR/FileAPI/#blob)\n     * argument on success; rejected promise on failure\n     */\n    takePhoto() {\n      const self = this;\n      return new Promise(function executorTP(resolve, reject) {\n        // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n        // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n        if (self._videoStreamTrack.readyState !== 'live') {\n          return reject(new DOMException('InvalidStateError'));\n        }\n        self.videoElementPlaying.then(() => {\n          try {\n            self.canvasElement.width = self.videoElement.videoWidth;\n            self.canvasElement.height = self.videoElement.videoHeight;\n            self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n            self.canvasElement.toBlob(resolve);\n          } catch (error) {\n            reject(new DOMException('UnknownError'));\n          }\n        });\n      });\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-grabframe\n     * @return {Promise<ImageBitmap>} Fulfilled promise with\n     * [ImageBitmap](https://www.w3.org/TR/html51/webappapis.html#webappapis-images)\n     * argument on success; rejected promise on failure\n     */\n    grabFrame() {\n      const self = this;\n      return new Promise(function executorGF(resolve, reject) {\n        // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n        // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n        if (self._videoStreamTrack.readyState !== 'live') {\n          return reject(new DOMException('InvalidStateError'));\n        }\n        self.videoElementPlaying.then(() => {\n          try {\n            self.canvasElement.width = self.videoElement.videoWidth;\n            self.canvasElement.height = self.videoElement.videoHeight;\n            self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n            // TODO polyfill https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmapFactories/createImageBitmap for IE\n            resolve(window.createImageBitmap(self.canvasElement));\n          } catch (error) {\n            reject(new DOMException('UnknownError'));\n          }\n        });\n      });\n    }\n  };\n}\n\nwindow.ImageCapture = ImageCapture;\n","import { findDocument, extractDocument, Point, Quad } from './process';\nimport { toPDF } from './pdf';\nimport { toImage, getData, download } from './io';\nimport { ProspectivePage, getFile, setFile } from './db';\nimport flashURL from 'url:./flash.svg';\nimport flashOffURL from 'url:./flash-off.svg';\nimport hdURL from 'url:./hd.svg';\nimport sdURL from 'url:./sd.svg';\nimport 'image-capture';\n\nconst root = document.getElementById('root') as HTMLDivElement;\nconst modal = document.getElementById('modal') as HTMLDivElement;\nconst captures = document.getElementById('captures') as HTMLDivElement;\nconst preview = document.getElementById('preview') as HTMLVideoElement;\nconst previewCrop = document.getElementById('preview-crop') as HTMLDivElement;\nconst previewDoc = document.getElementById('preview-doc') as HTMLDivElement;\nconst bottomWrapper = document.getElementById('bottom-wrapper') as HTMLDivElement;\nconst topWrapper = document.getElementById('top-wrapper') as HTMLDivElement;\nconst selectWrapper = document.getElementById('camera-select-wrapper') as HTMLDivElement;\nconst select = document.getElementById('camera-select') as HTMLSelectElement;\nconst qualityWrapper = document.getElementById('quality-wrapper') as HTMLDivElement;\nconst quality = document.getElementById('quality') as HTMLButtonElement;\nconst qualityImg = document.getElementById('quality-img') as HTMLImageElement;\nconst githubWrapper = document.getElementById('github-wrapper') as HTMLDivElement;\nconst flashWrapper = document.getElementById('flash-wrapper') as HTMLDivElement;\nconst flash = document.getElementById('flash') as HTMLButtonElement;\nconst flashImg = document.getElementById('flash-img') as HTMLImageElement;\nconst pastWrapper = document.getElementById('past-wrapper') as HTMLDivElement;\nconst past = document.getElementById('past') as HTMLDivElement;\nconst uploadWrapper = document.getElementById('upload-wrapper') as HTMLDivElement;\nconst upload = document.getElementById('upload') as HTMLInputElement;\nconst shutter = document.getElementById('shutter') as HTMLImageElement;\nconst doneWrapper = document.getElementById('done-wrapper') as HTMLDivElement;\nconst done = document.getElementById('done') as HTMLButtonElement;\nconst modalBottomWrapper = document.getElementById('modal-bottom-wrapper') as HTMLDivElement;\nconst modalCancelWrapper = document.getElementById('modal-cancel-wrapper') as HTMLDivElement;\nconst modalCancel = document.getElementById('modal-cancel') as HTMLButtonElement;\nconst modalDoneWrapper = document.getElementById('modal-done-wrapper') as HTMLDivElement;\nconst modalDone = document.getElementById('modal-done') as HTMLButtonElement;\ntype Dimensions = {\n  width: number;\n  height: number;\n};\n\ntype MaxRes = Dimensions & {\n  deviceId: string;\n};\n\nlet defaultMaxRes: Promise<MaxRes>;\nlet maxRes: Record<string, Promise<MaxRes> | undefined> = {};\n\ntype Page = ProspectivePage & {\n  img: HTMLImageElement | HTMLCanvasElement;\n};\n\nconst pages: Page[] = [];\n\nconst log = (text: string) => {\n  const el = document.createElement('div');\n  el.innerText = text;\n  root.appendChild(el);\n}\n\nconst resizeListeners: (() => void)[] = [];\n\nconst onResize = (listener: () => void) => {\n  resizeListeners.push(listener);\n  return () => {\n    resizeListeners.splice(resizeListeners.indexOf(listener), 1);\n  };\n};\n\nconst callResizeListeners = () => {\n  for (const listener of resizeListeners) {\n    listener();\n  }\n};\n\nlet rst = -1;\nwindow.addEventListener('resize', () => {\n  clearTimeout(rst);\n  rst = setTimeout(callResizeListeners, 250) as unknown as number;\n}, { passive: true });\n\nconst getMaxRes = (device?: string) => {\n  const constraints: MediaTrackConstraints = {\n    width: 100000,\n    height: 100000,\n    facingMode: 'environment'\n  };\n  if (device) {\n    if (maxRes[device]) return maxRes[device]!;\n    constraints.deviceId = { exact: device };\n  } else if (defaultMaxRes) {\n    return defaultMaxRes;\n  }\n  const prom = navigator.mediaDevices.getUserMedia({\n    video: constraints \n  }).then(media => {\n    const settings = media.getVideoTracks()[0].getSettings();\n    for (const track of media.getTracks()) {\n      track.stop();\n    }\n    const width = Math.max(settings.width!, settings.height!);\n    const height = Math.min(settings.width!, settings.height!);\n    return { width, height, deviceId: settings.deviceId! };\n  });\n  if (device) maxRes[device] = prom;\n  else defaultMaxRes = prom.then(val => {\n    maxRes[val.deviceId] = prom;\n    return val;\n  });\n  return prom;\n}\n\nconst point = (a: Point, scale: number) => {\n  const elem = document.createElement('div');\n  const mwh = Math.min(window.innerWidth, window.innerHeight);\n  elem.style.width = mwh * 0.03 + 'px';\n  elem.style.height = mwh * 0.03 + 'px';\n  elem.style.borderRadius = mwh * 0.015 + 'px';\n  elem.style.backgroundColor = 'black';\n  elem.style.position = 'absolute';\n  adjustPoint(elem, a, scale);\n  return elem;\n};\n\nconst adjustPoint = (elem: HTMLDivElement, a: Point, scale: number) => {\n  const mwh = Math.min(window.innerWidth, window.innerHeight);\n  elem.style.top = a.y * scale - mwh * 0.015 + 'px';\n  elem.style.left = a.x * scale - mwh * 0.015 + 'px';\n};\n\nconst line = (a: Point, b: Point, scale: number) => {\n  const elem = document.createElement('div');\n  elem.style.height = '4px';\n  elem.style.backgroundColor = 'red';\n  elem.style.position = 'absolute';\n  elem.style.transformOrigin = 'center left';\n  adjustLine(elem, a, b, scale);\n  return elem;\n};\n\nconst adjustLine = (elem: HTMLDivElement, a: Point, b: Point, scale: number) => {\n  elem.style.width = Math.hypot(a.x - b.x, a.y - b.y) * scale + 'px';\n  elem.style.top = a.y * scale + 'px';\n  elem.style.left = a.x * scale + 'px';\n  elem.style.transform = `rotate(${Math.atan2(b.y - a.y, b.x - a.x)}rad)`;\n}\n\nconst preprocessPhoto = async (src: Blob | ImageBitmap) => {\n  let img: HTMLImageElement | HTMLCanvasElement, data: ImageData;\n  if (src instanceof Blob) {\n    const image = await toImage(src);\n    img = image;\n    data = await getData(image);\n  } else {\n    const cnv = document.createElement('canvas');\n    cnv.width = src.width;\n    cnv.height = src.height;\n    cnv.getContext('2d')!.drawImage(src, 0, 0);\n    img = cnv;\n    data = await getData(src, true);\n  }\n  const quad = await findDocument(data) || {\n    a: { x: 0, y: data.height },\n    b: { x: 0, y: 0 },\n    c: { x: data.width, y: 0 },\n    d: { x: data.width, y: data.height }\n  };\n  const clampPoint = (a: Point) => {\n    if (a.x < 0) a.x = 0;\n    else if (a.x > data.width) a.x = data.width;\n    if (a.y < 0) a.y = 0;\n    else if (a.y > data.height) a.y = data.height;\n  };\n  clampPoint(quad.a);\n  clampPoint(quad.b);\n  clampPoint(quad.c);\n  clampPoint(quad.d);\n  return { img, data, quad };\n};\n\nconst processPhotos = async (srcs: (Blob | ImageBitmap | Page)[]) => {\n  const results = srcs.map(src => src instanceof Blob || src instanceof ImageBitmap ? preprocessPhoto(src) : src);\n  const cbs: ((check: boolean) => void)[] = [];\n  let firstDimensions = { width: 0, height: 0 };\n  let landscape = false;\n  for (const result of results) {\n    const isFirst = result == results[0];\n    const isLast = result == results[results.length - 1];\n    const { img, data, quad } = await result;\n    const imgCrop = document.createElement('div');\n    imgCrop.style.display = 'flex';\n    imgCrop.style.justifyContent = 'center';\n    imgCrop.style.alignItems = 'center';\n    imgCrop.style.overflow = 'hidden';\n    imgCrop.style.scrollSnapAlign = 'center';\n    const imgDoc = document.createElement('div');\n    imgDoc.style.position = 'relative';\n    imgDoc.appendChild(img);\n    imgCrop.appendChild(imgDoc);\n    modal.style.display = 'flex';\n    const aspectRatio = Math.max(data.width, data.height) / Math.min(data.width, data.height);\n    let scale = 0, docX = 0, docY = 0, latestDims = false;\n    let prevElems: HTMLDivElement[] = [];\n    const getLatestDims = () => {\n      if (!latestDims) {\n        const { left, top } = imgDoc.getBoundingClientRect();\n        docX = left;\n        docY = top;\n        latestDims = true; \n      }\n    }\n    const makePoint = (src: Point, onUpdate: () => void) => {\n      const pt = point(src, scale);\n      let active = false;\n      const onDown = (evt: MouseEvent | TouchEvent, x: number, y: number) => {\n        if (pt.parentElement == imgDoc) {\n          if (evt.target == pt || (evt.target == img && Math.hypot(x - src.x * scale, y - src.y * scale) < Math.min(window.innerWidth, window.innerHeight) * 0.2)) {\n            evt.stopImmediatePropagation();\n            active = true;\n            onMove(x, y);\n          }\n        } else {\n          imgDoc.removeEventListener('mousedown', onMouseDown);\n          imgDoc.removeEventListener('touchstart', onTouchStart);\n          imgDoc.removeEventListener('mousemove', onMouseMove);\n          imgDoc.removeEventListener('touchmove', onTouchMove);\n          imgDoc.removeEventListener('mouseup', onUp);\n          imgDoc.removeEventListener('touchend', onUp);\n        }\n      };\n      const onMove = (x: number, y: number) => {\n        src.x = x / scale;\n        src.y = y / scale;\n        adjustPoint(pt, src, scale);\n        onUpdate();\n      };\n      const onUp = () => {\n        active = false;\n      };\n      const onMouseDown = (e: MouseEvent) => {\n        getLatestDims();\n        onDown(e, e.pageX - docX, e.pageY - docY);\n      };\n      imgDoc.addEventListener('mousedown', onMouseDown);\n      const onTouchStart = (e: TouchEvent) => {\n        const touch = e.targetTouches[0];\n        getLatestDims();\n        onDown(e, touch.pageX - docX, touch.pageY - docY);\n      }\n      imgDoc.addEventListener('touchstart', onTouchStart);\n      const onMouseMove = (e: MouseEvent) => {\n        if (active) {\n          e.preventDefault();\n          onMove(e.pageX - docX, e.pageY - docY);\n        }\n      };\n      imgDoc.addEventListener('mousemove', onMouseMove);\n      const onTouchMove = (e: TouchEvent) => {\n        if (active) {\n          const touch = e.targetTouches[0];\n          e.preventDefault();\n          onMove(touch.pageX - docX, touch.pageY - docY);\n        }\n      }\n      imgDoc.addEventListener('touchmove', onTouchMove);\n      imgDoc.addEventListener('mouseup', onUp);\n      imgDoc.addEventListener('touchend', onUp);\n      return pt;\n    }\n    const paintLines = () => {\n      for (const elem of prevElems) {\n        imgDoc.removeChild(elem);\n      }\n      const ab = line(quad.a, quad.b, scale);\n      const bc = line(quad.b, quad.c, scale);\n      const cd = line(quad.c, quad.d, scale);\n      const da = line(quad.d, quad.a, scale);\n      prevElems = [\n        imgDoc.appendChild(ab),\n        imgDoc.appendChild(bc),\n        imgDoc.appendChild(cd),\n        imgDoc.appendChild(da),\n        imgDoc.appendChild(makePoint(quad.a, () => {\n          adjustLine(da, quad.d, quad.a, scale);\n          adjustLine(ab, quad.a, quad.b, scale);\n        })),\n        imgDoc.appendChild(makePoint(quad.b, () => {\n          adjustLine(ab, quad.a, quad.b, scale);\n          adjustLine(bc, quad.b, quad.c, scale);\n        })),\n        imgDoc.appendChild(makePoint(quad.c, () => {\n          adjustLine(bc, quad.b, quad.c, scale);\n          adjustLine(cd, quad.c, quad.d, scale);\n        })),\n        imgDoc.appendChild(makePoint(quad.d, () => {\n          adjustLine(cd, quad.c, quad.d, scale);\n          adjustLine(da, quad.d, quad.a, scale);\n        })),\n      ];\n    };\n    const updateImageDimensions = () => {\n      const { width, height } = isFirst ? calcDimensions(aspectRatio, 0.925) : firstDimensions;\n      if (isFirst) {\n        landscape = isLandscape(aspectRatio);\n        firstDimensions = { width, height };\n        modalCancelWrapper.style.width = modalCancelWrapper.style.height = modalDoneWrapper.style.width = modalDoneWrapper.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.035 + 'px';\n        modalCancelWrapper.style.margin = modalDoneWrapper.style.margin = (landscape ? window.innerWidth : window.innerHeight) * 0.02 + 'px';\n        captures.style.width = modal.style.width = window.innerWidth + 'px';\n        captures.style.height = modal.style.height = window.innerHeight + 'px';\n        modal.style.flexDirection = landscape ? 'row' : 'column';\n        captures.style.flexDirection = landscape ? 'column' : 'row';\n        if (landscape) {\n          modalBottomWrapper.style.flexDirection = 'column';\n          modalBottomWrapper.style.height = window.innerHeight + 'px';\n          modalBottomWrapper.style.width = ''; \n        } else {\n          modalBottomWrapper.style.flexDirection = 'row';\n          modalBottomWrapper.style.height = '';\n          modalBottomWrapper.style.width = window.innerWidth + 'px';   \n        }\n      }\n      const cssWidth = width + 'px';\n      const cssHeight = height + 'px';\n    \n      if (landscape) {\n        img.style.width = '';\n        img.style.height = cssHeight;\n        scale = window.innerHeight / data.height;\n      } else {\n        img.style.width = cssWidth;\n        img.style.height = '';\n        scale = window.innerWidth / data.width;\n      }\n      imgCrop.style.width = imgCrop.style.minWidth = cssWidth;\n      imgCrop.style.height = imgCrop.style.minHeight = cssHeight;\n      latestDims = false;\n      paintLines();\n    };\n    updateImageDimensions();\n    captures.appendChild(imgCrop);\n    const offResize = onResize(updateImageDimensions);\n    cbs.push(check => {\n      if (check) {\n        pages.push({ data, quad, img });\n        doneWrapper.style.opacity = '';\n        if (isLast) {\n          if (img.width > img.height) {\n            img.style.height = pastWrapper.style.height;\n            img.style.width = '';\n          } else {\n            img.style.height = '';\n            img.style.width = pastWrapper.style.width;\n          }\n          while (pastWrapper.lastChild != past) {\n            pastWrapper.removeChild(pastWrapper.lastChild!);\n          }\n          pastWrapper.appendChild(img);\n        }\n      }\n      offResize();\n      captures.removeChild(imgCrop);\n    })\n  }\n\n  return new Promise(resolve => {\n    const onDone = () => finish(true);\n    const onCancel = () => finish(false);\n    modalCancel.addEventListener('click', onCancel);\n    modalDone.addEventListener('click', onDone);\n    const finish = (check: boolean) => {\n      modalDone.removeEventListener('click', onDone);\n      modalCancel.removeEventListener('click', onCancel);\n      modal.style.display = 'none';\n      for (const cb of cbs) {\n        cb(check);\n      }\n      resolve(check);\n    };\n  });\n}\n\nconst isLandscape = (aspectRatio: number) => window.innerWidth > (window.innerHeight * aspectRatio);\n\nconst calcDimensions = (aspectRatio: number, maxRatio: number) => {\n  const landscape = isLandscape(aspectRatio);\n  const height = landscape ? window.innerHeight : Math.floor(Math.min(window.innerWidth * aspectRatio, window.innerHeight * maxRatio));\n  const width = landscape ? Math.floor(Math.min(window.innerHeight * aspectRatio, window.innerWidth * maxRatio)) : window.innerWidth;\n  return { width, height };\n}\n\nconst sideWrappers = [topWrapper, bottomWrapper];\nconst topElems = [flashWrapper, qualityWrapper, githubWrapper, selectWrapper, pastWrapper];\nconst bottomElems = [doneWrapper, uploadWrapper];\nconst allElems = topElems.concat(bottomElems, shutter);\n\nconst startStream = async (device?: string) => {\n  const maxRes = await getMaxRes(device);\n  let aspectRatio = maxRes.width / maxRes.height;\n  const landscape = isLandscape(aspectRatio);\n  const { width, height } = calcDimensions(aspectRatio, 0.84);\n  const cssHeight = height + 'px';\n  const cssWidth = width + 'px';\n  previewCrop.style.width = previewCrop.style.minWidth = cssWidth;\n  previewCrop.style.height = previewCrop.style.minHeight = cssHeight;\n  root.style.width = window.innerWidth + 'px';\n  root.style.height = window.innerHeight + 'px';\n  for (const sideWrapper of sideWrappers) {\n    if (landscape) {\n      sideWrapper.style.flexDirection = 'column';\n      sideWrapper.style.height = window.innerHeight + 'px';\n      sideWrapper.style.width = '';\n    } else {\n      sideWrapper.style.flexDirection = 'row';\n      sideWrapper.style.height = '';\n      sideWrapper.style.width = window.innerWidth + 'px';   \n    }\n  }\n  for (const topElem of topElems) {\n    topElem.style.width = topElem.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.03 + 'px';\n  }\n  for (const bottomElem of bottomElems) {\n    bottomElem.style.width = bottomElem.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.035 + 'px';\n  }\n  for (const elem of allElems) {\n    elem.style.margin = (landscape ? window.innerWidth : window.innerHeight) * 0.02 + 'px';\n  }\n  shutter.style.width = shutter.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.05 + 'px';\n  const pastBorderSize = (landscape ? window.innerWidth : window.innerHeight) * 0.002 + 'px';\n  pastWrapper.style.borderRadius = pastBorderSize;\n  pastWrapper.style.border = pastBorderSize + ' solid white';\n  if (landscape) {\n    preview.style.height = cssHeight;\n    preview.style.width = '';\n    root.style.flexDirection = 'row';\n  } else {\n    preview.style.height = '';\n    preview.style.width = cssWidth;\n    root.style.flexDirection = 'column';\n  }\n  const constraints: MediaTrackConstraints = {\n    width: maxRes.width, \n    height: maxRes.height,\n    deviceId: { exact: maxRes.deviceId }\n  };\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: constraints\n  });\n  const videoTrack = stream.getVideoTracks()[0];\n  const capabilities = videoTrack.getCapabilities();\n  flashWrapper.style.display = capabilities.torch ? '' : 'none';\n  preview.srcObject = stream;\n  let newElems: Node[] = [];\n  const clearNewElems = () => {\n    for (const elem of newElems) {\n      previewDoc.removeChild(elem);\n    };\n    newElems.length = 0;\n  }\n  const onMetadata = () => {\n    const scale = landscape ? window.innerHeight / preview.videoHeight : window.innerWidth / preview.videoWidth;\n    const docPreview = async () => {\n      let quad: Quad | undefined;\n      const ts = performance.now();\n      if (modal.style.display == 'none') {\n        quad = await findDocument(await getData(await cap.grabFrame()), true);\n      }\n      clearNewElems();\n      if (docPreviewTimeout != -1) {\n        if (quad) {\n          newElems = [\n            previewDoc.appendChild(line(quad.a, quad.b, scale)),\n            previewDoc.appendChild(line(quad.b, quad.c, scale)),\n            previewDoc.appendChild(line(quad.c, quad.d, scale)),\n            previewDoc.appendChild(line(quad.d, quad.a, scale))\n          ];\n        }\n        docPreviewTimeout = setTimeout(docPreview, Math.max(250 - performance.now() + ts, 0)) as unknown as number;\n      }\n    };\n    docPreviewTimeout = setTimeout(docPreview, 0) as unknown as number;\n  };\n  preview.addEventListener('loadedmetadata', onMetadata);\n  const cap = new ImageCapture(videoTrack);\n  let hd = Object.prototype.toString.call(cap) == '[object ImageCapture]';\n  qualityWrapper.style.display = hd ? '' : 'none';\n  qualityImg.src = hdURL;\n  const onQualityClick = () => {\n    hd = !hd;\n    qualityImg.src = hd ? hdURL : sdURL;\n  };\n  quality.addEventListener('click', onQualityClick);\n  let docPreviewTimeout = -1;\n  const shutterFlash = () => {\n    preview.style.opacity = '0';\n    setTimeout(() => preview.style.opacity = '', 50);\n  };\n  const onShutterClick = async () => {\n    if (shutter.style.opacity == '') {\n      shutter.style.opacity = '0.5';\n      shutterFlash();\n      try {\n        const photo = hd ? await cap.takePhoto() : await cap.grabFrame();\n        await processPhotos([photo]);\n      } catch (e) {}\n      shutter.style.opacity = '';\n    }\n  };\n  shutter.addEventListener('click', onShutterClick);\n  let torch = false;\n  flashImg.src = flashOffURL;\n  const onFlashClick = async () => {\n    try {\n      torch = !torch;\n      await videoTrack.applyConstraints({\n        advanced: [{ torch }]\n      });\n      flashImg.src = torch ? flashURL : flashOffURL;\n    } catch (e) {}\n  };\n  flash.addEventListener('click', onFlashClick);\n  return {\n    deviceId: maxRes.deviceId,\n    close() {\n      clearTimeout(docPreviewTimeout);\n      docPreviewTimeout = -1;\n      shutter.removeEventListener('click', onShutterClick);\n      flash.removeEventListener('click', onFlashClick);\n      quality.removeEventListener('click', onQualityClick);\n      preview.removeEventListener('loadedmetadata', onMetadata);\n      preview.pause();\n      for (const track of stream.getTracks()) {\n        track.stop();\n      }\n    }\n  }\n}\n\n\nconst onLoad = async () => {\n  let stream = await startStream(localStorage.getItem('defaultDevice')!);\n  const updateBold = () => {\n    for (const option of select.options) {\n      option.style.fontWeight = '';\n    }\n    select.selectedOptions[0].style.fontWeight = 'bold';\n  }\n  for (const device of await navigator.mediaDevices.enumerateDevices()) {\n    if (device.kind == 'videoinput') {\n      const option = document.createElement('option');\n      option.value = device.deviceId;\n      option.label = device.label;\n      select.appendChild(option);\n    }\n  }\n  select.value = stream.deviceId;\n  updateBold();\n  const update = async () => {\n    updateBold();\n    stream.close();\n    select.disabled = true;\n    localStorage.setItem('defaultDevice', select.value);\n    stream = await startStream(select.value);\n    select.disabled = false;\n  };\n  select.onchange = update;\n  onResize(update);\n  upload.onchange = async () => {\n    shutter.style.opacity = '0.5';\n    await processPhotos([...upload.files!]);\n    shutter.style.opacity = '';\n  };\n  done.onclick = async () => {\n    if (pages.length) {\n      doneWrapper.style.opacity = '0.5';\n      while (pastWrapper.lastChild != past) {\n        pastWrapper.removeChild(pastWrapper.lastChild!);\n      }\n      download(new Blob([await toPDF(await Promise.all(pages.map(({ data, quad }) => extractDocument(data, quad, 1224))))]), 'out.pdf')\n      pages.length = 0;\n    }\n  }\n  past.onclick = async () => {\n    if (pages.length) {\n      const currPages = pages.slice();\n      pages.length = 0;\n      if (!(await processPhotos(currPages))) {\n        pages.push(...currPages);\n        const { img } = currPages[currPages.length - 1];\n        if (img.width > img.height) {\n          img.style.height = pastWrapper.style.height;\n          img.style.width = '';\n        } else {\n          img.style.height = '';\n          img.style.width = pastWrapper.style.width;\n        }\n        while (pastWrapper.lastChild != past) {\n          pastWrapper.removeChild(pastWrapper.lastChild!);\n        }\n        pastWrapper.appendChild(img);\n      }\n    }\n  }\n}\n\nonLoad();\n\nif (process.env.NODE_ENV == 'production') {\n  navigator.serviceWorker.register(new URL('./workers/service.ts', import.meta.url), { type: 'module' });\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('d3X8m') + \"workers/\" + require('./helpers/bundle-manifest').resolve(\"HMBE2\");"],"names":["$9da314a8eca4cf65$var$wasm","$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$9da314a8eca4cf65$var$heap","Array","fill","undefined","$9da314a8eca4cf65$var$getObject","idx","push","$9da314a8eca4cf65$var$heap_next","$9da314a8eca4cf65$var$takeObject","ret","$9da314a8eca4cf65$var$dropObject","$9da314a8eca4cf65$var$debugString","val","type","description","name","isArray","debug","builtInMatches","exec","toString","call","className","stringify","_","message","stack","$9da314a8eca4cf65$var$WASM_VECTOR_LEN","$9da314a8eca4cf65$var$cachegetUint8Memory0","$9da314a8eca4cf65$var$getUint8Memory0","buffer","memory","Uint8Array","$9da314a8eca4cf65$var$cachedTextEncoder","TextEncoder","$9da314a8eca4cf65$var$encodeString","encodeInto","arg","view","buf","encode","set","read","written","$9da314a8eca4cf65$var$cachegetInt32Memory0","$9da314a8eca4cf65$var$getInt32Memory0","Int32Array","$9da314a8eca4cf65$var$cachedTextDecoder","TextDecoder","ignoreBOM","fatal","$9da314a8eca4cf65$var$_assertClass","instance","klass","ptr","$9da314a8eca4cf65$var$addHeapObject","obj","$9da314a8eca4cf65$var$isLikeNone","x","decode","$9da314a8eca4cf65$var$cachegetUint8ClampedMemory0","$9da314a8eca4cf65$var$getClampedArrayU8FromWasm0","len","Uint8ClampedArray","subarray","$9da314a8eca4cf65$var$handleError","f","args","apply","this","e","__wbindgen_exn_store","$9da314a8eca4cf65$export$baf26146a414f24a","create","prototype","__destroy_into_raw","free","__wbg_point_free","__wbg_get_point_x","arg06","__wbg_set_point_x","y","__wbg_get_point_y","arg01","__wbg_set_point_y","$9da314a8eca4cf65$export$7005c9eb6671414d","ptr1","__wbg_quad_free","a","__wbg_get_quad_a","__wrap","arg02","ptr0","__wbg_set_quad_a","b","__wbg_get_quad_b","arg03","__wbg_set_quad_b","c","__wbg_get_quad_c","arg04","__wbg_set_quad_c","d","__wbg_get_quad_d","arg05","__wbg_set_quad_d","constructor","ax","ay","bx","by","cx","cy","dx","dy","quad_new","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$export$5a759dc7a1cfb72a","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","replace","value","err","matches","match","$f29cd6c67ea13581$var$getBundleURL","$ad8fe765465c73db$exports","getBundleURL","resolve","$9da314a8eca4cf65$export$2e2bcd8739ae039","$9da314a8eca4cf65$var$init","input","URL","imports","wbg","__wbg_width_16bd64d09cbf5661","arg0","width","__wbg_height_368bb86c37d51bc9","height","__wbg_data_1ae7496c58caf755","arg1","malloc","$9da314a8eca4cf65$var$passArray8ToWasm0","data","__wbindgen_malloc","len0","__wbindgen_object_drop_ref","__wbg_newwithu8clampedarrayandsh_1b8c6e1bede43657","arg2","arg3","ImageData","arguments","__wbindgen_debug_string","realloc","mem","offset","code","charCodeAt","slice","$9da314a8eca4cf65$var$passStringToWasm0","__wbindgen_realloc","__wbindgen_throw","Request","fetch","module","Response","WebAssembly","instantiateStreaming","headers","get","console","warn","bytes","arrayBuffer","instantiate","Instance","$9da314a8eca4cf65$var$load","exports","__wbindgen_wasm_module","$3792a830f018d59d$var$handle","quad","find_document","result","region","target_width","target_height","extract_document","$9da314a8eca4cf65$export$e71c94bb735e34f6","targetWidth","targetHeight","transfer","bitmap","ctx","OffscreenCanvas","getContext","drawImage","getImageData","TypeError","$3792a830f018d59d$var$load","catch","onmessage","async","evt","msg","postMessage","error","$cc58a565ddb34980$exports","workerUrl","origin","isESM","self","location","source","createObjectURL","Blob","$a91bef678e3f3fb0$var$url","$kPq84","$a91bef678e3f3fb0$exports","getOrigin","$aace96fe4c9ab88a$var$newWorker","Worker","$aace96fe4c9ab88a$var$processWorkers","navigator","hardwareConcurrency","$aace96fe4c9ab88a$var$messageID","$aace96fe4c9ab88a$var$message","Promise","reject","worker","pop","onMessage","mid","$aace96fe4c9ab88a$var$returnWorker","removeEventListener","addEventListener","$aace96fe4c9ab88a$export$c5fefc891e91de4b","$275cb23c0e6d88e6$var$readFile","fr","FileReader","onload","onerror","readAsArrayBuffer","$275cb23c0e6d88e6$export$99fdcdff3bb1ad24","images","pdfChunks","index","offsets","write","chunk","token","concat","chunks","chunk1","comment","content","number","array","fn","dict","values","key","stream","desc","object","reference","pages","all","map","img","canvas","document","createElement","putImageData","jpeg","toBlob","jpegData","image","Type","Subtype","Width","Height","ColorSpace","BitsPerComponent","Filter","Length","contents","Parent","Resources","XObject","I","Contents","MediaBox","pageRoot","Kids","page","Count","catalog","Pages","xrefOffset","padStart","Size","Root","$fedec97397178479$var$sharedCanvas","$fedec97397178479$var$sharedCtx","$fedec97397178479$export$7a171f172be0782e","$aace96fe4c9ab88a$export$6806abd6abc725de","ImageBitmap","createImageBitmap","$b6da29917bd63570$exports","$0e5b71de247ee0ab$exports","$fee378d56c5686a2$exports","$ff484818f52c5c48$exports","$435d3e7d9a1d1c67$export$d2caa7debd66c3ef","window","ImageCapture","videoStreamTrack","kind","DOMException","_videoStreamTrack","readyState","_previewStream","MediaStream","videoElement","videoElementPlaying","HTMLMediaElement","srcObject","src","muted","setAttribute","play","canvasElement","canvas2dContext","getPhotoCapabilities","MediaSettingsRange","current","min","max","exposureCompensation","exposureMode","fillLightMode","focusMode","imageHeight","imageWidth","iso","redEyeReduction","whiteBalanceMode","zoom","setOptions","photoSettings","takePhoto","then","videoWidth","videoHeight","grabFrame","$e04467055a32edce$var$root","getElementById","$e04467055a32edce$var$modal","$e04467055a32edce$var$captures","$e04467055a32edce$var$preview","$e04467055a32edce$var$previewCrop","$e04467055a32edce$var$previewDoc","$e04467055a32edce$var$bottomWrapper","$e04467055a32edce$var$topWrapper","$e04467055a32edce$var$selectWrapper","$e04467055a32edce$var$select","$e04467055a32edce$var$qualityWrapper","$e04467055a32edce$var$quality","$e04467055a32edce$var$qualityImg","$e04467055a32edce$var$githubWrapper","$e04467055a32edce$var$flashWrapper","$e04467055a32edce$var$flash","$e04467055a32edce$var$flashImg","$e04467055a32edce$var$pastWrapper","$e04467055a32edce$var$past","$e04467055a32edce$var$uploadWrapper","$e04467055a32edce$var$upload","$e04467055a32edce$var$shutter","$e04467055a32edce$var$doneWrapper","$e04467055a32edce$var$done","$e04467055a32edce$var$modalBottomWrapper","$e04467055a32edce$var$modalCancelWrapper","$e04467055a32edce$var$modalCancel","$e04467055a32edce$var$modalDoneWrapper","$e04467055a32edce$var$modalDone","$e04467055a32edce$var$defaultMaxRes","$e04467055a32edce$var$maxRes","$e04467055a32edce$var$pages","$e04467055a32edce$var$resizeListeners","$e04467055a32edce$var$onResize","listener","splice","indexOf","$e04467055a32edce$var$callResizeListeners","$e04467055a32edce$var$rst","clearTimeout","setTimeout","passive","$e04467055a32edce$var$point","scale","elem","mwh","Math","innerWidth","innerHeight","style","borderRadius","backgroundColor","position","$e04467055a32edce$var$adjustPoint","top","left","$e04467055a32edce$var$line","transformOrigin","$e04467055a32edce$var$adjustLine","hypot","transform","atan2","$e04467055a32edce$var$preprocessPhoto","loaded","revokeObjectURL","$fedec97397178479$export$85ada9a21afbeab6","cnv","clampPoint","$e04467055a32edce$var$processPhotos","srcs","results","cbs","firstDimensions","landscape","isFirst","isLast","imgCrop","display","justifyContent","alignItems","overflow","scrollSnapAlign","imgDoc","appendChild","aspectRatio","docX","docY","latestDims","prevElems","getLatestDims","getBoundingClientRect","makePoint","onUpdate","pt","active","onDown","parentElement","target","stopImmediatePropagation","onMove","onMouseDown","onTouchStart","onMouseMove","onTouchMove","onUp","pageX","pageY","touch","targetTouches","preventDefault","paintLines","removeChild","ab","bc","cd","da","updateImageDimensions","$e04467055a32edce$var$calcDimensions","$e04467055a32edce$var$isLandscape","margin","flexDirection","cssWidth","cssHeight","minWidth","minHeight","offResize","check","opacity","lastChild","onDone","finish","onCancel","cb","maxRatio","floor","$e04467055a32edce$var$sideWrappers","$e04467055a32edce$var$topElems","$e04467055a32edce$var$bottomElems","$e04467055a32edce$var$allElems","$e04467055a32edce$var$startStream","device","maxRes","constraints","facingMode","deviceId","exact","prom","mediaDevices","getUserMedia","video","media","settings","getVideoTracks","getSettings","track","getTracks","stop","$e04467055a32edce$var$getMaxRes","sideWrapper","topElem","bottomElem","elem1","pastBorderSize","border","videoTrack","capabilities","getCapabilities","torch","newElems","onMetadata","docPreview","ts","performance","now","cap","clearNewElems","docPreviewTimeout","hd","$parcel$interopDefault","onQualityClick","onShutterClick","photo","onFlashClick","applyConstraints","advanced","close","pause","localStorage","getItem","updateBold","option","options","fontWeight","selectedOptions","enumerateDevices","label","update","disabled","setItem","onchange","files","onclick","file","el","download","href","click","$fedec97397178479$export$24422be91ad4011f","$aace96fe4c9ab88a$export$ab8ba24d4c0c8986","currPages","$e04467055a32edce$var$onLoad","$3a30c74b38a2baed$exports","serviceWorker"],"version":3,"file":"index.3b2fec53.js.map"}